<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>第10讲 tidyquant & Friends</title>
    <meta charset="utf-8" />
    <meta name="author" content=" 曾永艺" />
    <meta name="date" content="2023-12-14" />
    <script src="../libs/header-attrs/header-attrs.js"></script>
    <link href="../libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="../libs/tile-view/tile-view.js"></script>
    <link href="../libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="../libs/panelset/panelset.css" rel="stylesheet" />
    <script src="../libs/panelset/panelset.js"></script>
    <link href="../libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="../libs/clipboard/clipboard.min.js"></script>
    <link href="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-copy\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="../libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="../libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <script src="../libs/kePrint/kePrint.js"></script>
    <link href="../libs/lightable/lightable.css" rel="stylesheet" />
    <script src="../libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="../libs/jquery/jquery.min.js"></script>
    <link href="../libs/dygraphs/dygraph.css" rel="stylesheet" />
    <script src="../libs/dygraphs/dygraph-combined.js"></script>
    <script src="../libs/dygraphs/shapes.js"></script>
    <script src="../libs/moment/moment.js"></script>
    <script src="../libs/moment-timezone/moment-timezone-with-data.js"></script>
    <script src="../libs/moment-fquarter/moment-fquarter.min.js"></script>
    <script src="../libs/dygraphs-binding/dygraphs.js"></script>
    <link rel="stylesheet" href="../libs/zen-styles-v2.3-rev.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# 量化金融与金融编程
]
.subtitle[
## <br>L10 tidyquant &amp; Friends
]
.author[
### <br>曾永艺
]
.institute[
### 厦门大学管理学院
]
.date[
### <br>2023-12-15
]

---




<div>
<style type="text/css">.xaringan-extra-logo {
width: 50px;
height: 50px;
z-index: 0;
background-image: url(imgs/logo-sm.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.5em;right:0.5em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

&lt;br&gt;

&lt;img src="imgs/tidyverse-xts-01.png" width="100%" style="display: block; margin: auto;" /&gt;

--

.pull-left.Large.bold[

- 强大且通用的数据处理工具

- 分组运算

- 支持异质数据

- 代码可读性 &gt; 运行性能

]

--

.pull-right.Large.bold[

- 原生支持时间索引

- 专用且快速的基于时间的&lt;br&gt;数据处理

- 同质数据（矩阵）

- 众多金融分析工具

]

---

&lt;br&gt;

&lt;img src="imgs/tidyverse-xts-02.png" width="100%" style="display: block; margin: auto;" /&gt;


.pull-left.Large.bold[

- 强大且通用的数据处理工具

- 分组运算

- 支持异质数据

- 代码可读性 &gt; 运行性能

]

.pull-right.Large.bold[

- 原生支持时间索引

- 专用且快速的基于时间的&lt;br&gt;数据处理

- 同质数据（矩阵）

- 众多金融分析工具

]

---
class: inverse, center, middle
background-image: url(imgs/logo-tidyquant.png), url(imgs/bg.png)
background-size: 10%, 100%
background-position: 20% 40%, 0% 100%

# 1. `tidyquant` 包 &lt;sup&gt;.font60[v1.0.7]&lt;/sup&gt;

.font150[_Tidy Quantitative Financial Analysis_]

---
layout: true

### &gt;&gt; `tidyquant` 包

---

.code100[

```r
library(tidyverse)
*library(tidyquant)     # install.packages("tidyquant")
# tidyquant包会自动载入 lubridate, PerformanceAnalytics -&gt; xts -&gt; zoo, 
#     quantmod -&gt; xts / zoo / TTR 等包
```
]

--

.pull-left[
.full-width[.content-box-blue.bold.font130[核心函数 &amp;nbsp;&amp;nbsp;&amp;nbsp; 👉]]
]

.pull-right[
&lt;img src="imgs/tidyquant-01.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---
layout: true

### &gt;&gt; `tidyquant`：导入数据

---

.code90[

```r
# ?riingo::riingo_set_token  # 按照 Details 的说明完成设置
                             # 需到 https://www.tiingo.com/ 注册账号获取令牌
set.seed(123456)
(SP500_sample &lt;- 
* tq_index("SP500") %&gt;%  # source: www.ssga.com
  slice_sample(n = 10) %&gt;% pull("symbol") %&gt;% 
* tq_get(
    get  = "tiingo", # ~~ get = "stock.prices"  # yahoo ~~
    from = "2018-12-31",
    to   = "2022-12-31",
    complete_cases = TRUE   # default
  ))   # tq_*() returns data in tibble!
```

```
#&gt; # A tibble: 10,090 × 14
#&gt;   symbol date                 open  high   low close    volume adjusted adjHigh adjLow
#&gt;   &lt;chr&gt;  &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 GE     2018-12-31 00:00:00  7.52  7.62  7.35  7.57 108361489     44.6    44.9   43.3
#&gt; 2 GE     2019-01-02 00:00:00  7.46  8.18  7.41  8.05 129354094     47.5    48.2   43.7
#&gt; 3 GE     2019-01-03 00:00:00  8.02  8.2   7.78  8.06 122949016     47.5    48.3   45.9
#&gt; # ℹ 10,087 more rows
#&gt; # ℹ 4 more variables: adjOpen &lt;dbl&gt;, adjVolume &lt;int&gt;, divCash &lt;dbl&gt;, splitFactor &lt;dbl&gt;
```
]

---

.code90[

```r
# tq_index() returns the stock symbol, company name, weight and sector
# of every stock in an index. The source is www.ssga.com.
tq_index_options()
```

```
#&gt; [1] "DOW"       "DOWGLOBAL" "SP400"     "SP500"     "SP600"
```

```r
# tq_exchange() returns the stock symbol, company, last sale price, 
# market capitalization, sector and industry of every stock in an exchange. 
# The source is www.nasdaq.com.
tq_exchange_options()
```

```
#&gt; [1] "AMEX"   "NASDAQ" "NYSE"
```

```r
# tq_get() is a consolidated function that gets data from various web sources.
tq_get_options()
```

```
#&gt;  [1] "stock.prices"       "stock.prices.japan" "dividends"          "splits"            
#&gt;  [5] "economic.data"      "quandl"             "quandl.datatable"   "tiingo"            
#&gt;  [9] "tiingo.iex"         "tiingo.crypto"      "alphavantager"      "alphavantage"      
#&gt; [13] "rblpapi"
```
]

---

layout: true

### &gt;&gt; `tidyquant`：数据转化

---

.code90[

```r
(SP500_ret &lt;- SP500_sample %&gt;% 
  group_by(symbol) %&gt;% 
* tq_transmute(
    select     = adjusted,      # the columns passed to the mutate_fun
*   mutate_fun = periodReturn,  # mutation function
    col_rename = "dr",          # a character vector to rename columns
    # ...: parameters passed to the mutate_fun -&gt;
    period     = "daily", 
    type       = "log", 
    leading    = FALSE
  ))
```

```
#&gt; # A tibble: 10,090 × 3
#&gt; # Groups:   symbol [10]
#&gt;   symbol date                      dr
#&gt;   &lt;chr&gt;  &lt;dttm&gt;                 &lt;dbl&gt;
#&gt; 1 GE     2018-12-31 00:00:00 NA      
#&gt; 2 GE     2019-01-02 00:00:00  0.0615 
#&gt; 3 GE     2019-01-03 00:00:00  0.00124
#&gt; # ℹ 10,087 more rows
```
]

---

.code75[

```r
tq_mutate_fun_options()[c("xts", "zoo", "quantmod")]  # 27 + 14 + 25
```

```
#&gt; $xts
#&gt;  [1] "apply.daily"     "apply.monthly"   "apply.quarterly" "apply.weekly"   
#&gt;  [5] "apply.yearly"    "diff.xts"        "lag.xts"         "period.apply"   
#&gt;  [9] "period.max"      "period.min"      "period.prod"     "period.sum"     
#&gt; [13] "periodicity"     "to.daily"        "to.hourly"       "to.minutes"     
#&gt; [17] "to.minutes10"    "to.minutes15"    "to.minutes3"     "to.minutes30"   
#&gt; [21] "to.minutes5"     "to.monthly"      "to.period"       "to.quarterly"   
#&gt; [25] "to.weekly"       "to.yearly"       "to_period"      
#&gt; 
#&gt; $zoo
#&gt;  [1] "rollapply"          "rollapplyr"         "rollmax"            "rollmax.default"   
#&gt;  [5] "rollmaxr"           "rollmean"           "rollmean.default"   "rollmeanr"         
#&gt;  [9] "rollmedian"         "rollmedian.default" "rollmedianr"        "rollsum"           
#&gt; [13] "rollsum.default"    "rollsumr"          
#&gt; 
#&gt; $quantmod
#&gt;  [1] "allReturns"      "annualReturn"    "ClCl"            "dailyReturn"    
#&gt;  [5] "Delt"            "HiCl"            "Lag"             "LoCl"           
#&gt;  [9] "LoHi"            "monthlyReturn"   "Next"            "OpCl"           
#&gt; [13] "OpHi"            "OpLo"            "OpOp"            "periodReturn"   
#&gt; [17] "quarterlyReturn" "seriesAccel"     "seriesDecel"     "seriesDecr"     
#&gt; [21] "seriesHi"        "seriesIncr"      "seriesLo"        "weeklyReturn"   
#&gt; [25] "yearlyReturn"
```
]

---

.code75[

```r
tq_mutate_fun_options()[c("TTR", "PerformanceAnalytics")]  # 64 + 7
```

```
#&gt; $TTR
#&gt;  [1] "adjRatios"          "ADX"                "ALMA"               "aroon"             
#&gt;  [5] "ATR"                "BBands"             "CCI"                "chaikinAD"         
#&gt;  [9] "chaikinVolatility"  "CLV"                "CMF"                "CMO"               
#&gt; [13] "CTI"                "DEMA"               "DonchianChannel"    "DPO"               
#&gt; [17] "DVI"                "EMA"                "EMV"                "EVWMA"             
#&gt; [21] "GMMA"               "growth"             "HMA"                "keltnerChannels"   
#&gt; [25] "KST"                "lags"               "MACD"               "MFI"               
#&gt; [29] "momentum"           "OBV"                "PBands"             "ROC"               
#&gt; [33] "rollSFM"            "RSI"                "runCor"             "runCov"            
#&gt; [37] "runMAD"             "runMax"             "runMean"            "runMedian"         
#&gt; [41] "runMin"             "runPercentRank"     "runSD"              "runSum"            
#&gt; [45] "runVar"             "SAR"                "SMA"                "SMI"               
#&gt; [49] "SNR"                "stoch"              "TDI"                "TR"                
#&gt; [53] "TRIX"               "ultimateOscillator" "VHF"                "volatility"        
#&gt; [57] "VWAP"               "VWMA"               "wilderSum"          "williamsAD"        
#&gt; [61] "WMA"                "WPR"                "ZigZag"             "ZLEMA"             
#&gt; 
#&gt; $PerformanceAnalytics
#&gt; [1] "Return.annualized"        "Return.annualized.excess" "Return.clean"            
#&gt; [4] "Return.cumulative"        "Return.excess"            "Return.Geltner"          
#&gt; [7] "zerofill"
```
]

---
layout: true

### &gt;&gt; `tidyquant`：数据分析

---

.pull-left.code90[

```r
# use mutate() or summarise()
SP500_ret %&gt;% 
  filter(!is.na(dr)) %&gt;% 
  summarise(
    mean_ret = mean(dr),
    sd_ret   = sd(dr),
    n_ret    = n()
  ) %&gt;% print(n = 10)
```

```
#&gt; # A tibble: 10 × 4
#&gt;    symbol    mean_ret sd_ret n_ret
#&gt;    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
#&gt;  1 CMG     0.00116    0.0234  1008
#&gt;  2 COO     0.000260   0.0190  1008
#&gt;  3 EXC     0.000425   0.0190  1008
#&gt;  4 FIS    -0.000354   0.0234  1008
#&gt;  5 FTNT    0.00123    0.0286  1008
#&gt;  6 GE      0.000377   0.0280  1008
#&gt;  7 ODFL    0.00124    0.0217  1008
#&gt;  8 PPG     0.000273   0.0202  1008
#&gt;  9 TEL     0.000485   0.0212  1008
#&gt; 10 WFC     0.00000548 0.0253  1008
```

]

--

.pull-right.code90[

```r
# use tq_performance()
SP500_ret %&gt;%
* tq_performance(
    Ra = dr,  # Rb = NULL,
*   performance_fun =
*     table.AnnualizedReturns,
    geometric = FALSE  # ...
  )
```

```
#&gt; # A tibble: 10 × 4
#&gt; # Groups:   symbol [10]
#&gt;   symbol AnnualizedReturn
#&gt;   &lt;chr&gt;             &lt;dbl&gt;
#&gt; 1 GE               0.095 
#&gt; 2 PPG              0.0688
#&gt; 3 WFC              0.0014
#&gt; 4 COO              0.0656
#&gt; # ℹ 6 more rows
#&gt; # ℹ 2 more variables:
#&gt; #   `AnnualizedSharpe(Rf=0%)` &lt;dbl&gt;,
#&gt; #   AnnualizedStdDev &lt;dbl&gt;
```
]

---

.code75[

```r
tq_performance_fun_options()[1:4]  # 19 + 13 + 7 + 9
```

```
#&gt; $table.funs
#&gt;  [1] "table.AnnualizedReturns" "table.Arbitrary"         "table.Autocorrelation"  
#&gt;  [4] "table.CAPM"              "table.CaptureRatios"     "table.Correlation"      
#&gt;  [7] "table.Distributions"     "table.DownsideRisk"      "table.DownsideRiskRatio"
#&gt; [10] "table.DrawdownsRatio"    "table.HigherMoments"     "table.InformationRatio" 
#&gt; [13] "table.RollingPeriods"    "table.SFM"               "table.SpecificRisk"     
#&gt; [16] "table.Stats"             "table.TrailingPeriods"   "table.UpDownRatios"     
#&gt; [19] "table.Variability"      
#&gt; 
#&gt; $CAPM.funs
#&gt;  [1] "CAPM.alpha"       "CAPM.beta"        "CAPM.beta.bear"   "CAPM.beta.bull"  
#&gt;  [5] "CAPM.CML"         "CAPM.CML.slope"   "CAPM.dynamic"     "CAPM.epsilon"    
#&gt;  [9] "CAPM.jensenAlpha" "CAPM.RiskPremium" "CAPM.SML.slope"   "TimingRatio"     
#&gt; [13] "MarketTiming"    
#&gt; 
#&gt; $SFM.funs
#&gt; [1] "SFM.alpha"       "SFM.beta"        "SFM.CML"         "SFM.CML.slope"  
#&gt; [5] "SFM.dynamic"     "SFM.epsilon"     "SFM.jensenAlpha"
#&gt; 
#&gt; $descriptive.funs
#&gt; [1] "mean"           "sd"             "min"            "max"            "cor"           
#&gt; [6] "mean.geometric" "mean.stderr"    "mean.LCL"       "mean.UCL"
```
]

---

.code80[

```r
tq_performance_fun_options()[5:9]  # 4 + 5 + 14 + 6 + 6
```

```
#&gt; $annualized.funs
#&gt; [1] "Return.annualized"        "Return.annualized.excess" "sd.annualized"           
#&gt; [4] "SharpeRatio.annualized"  
#&gt; 
#&gt; $VaR.funs
#&gt; [1] "VaR"  "ES"   "ETL"  "CDD"  "CVaR"
#&gt; 
#&gt; $moment.funs
#&gt;  [1] "var"              "cov"              "skewness"         "kurtosis"        
#&gt;  [5] "CoVariance"       "CoSkewness"       "CoSkewnessMatrix" "CoKurtosis"      
#&gt;  [9] "CoKurtosisMatrix" "M3.MM"            "M4.MM"            "BetaCoVariance"  
#&gt; [13] "BetaCoSkewness"   "BetaCoKurtosis"  
#&gt; 
#&gt; $drawdown.funs
#&gt; [1] "AverageDrawdown"   "AverageLength"     "AverageRecovery"   "DrawdownDeviation"
#&gt; [5] "DrawdownPeak"      "maxDrawdown"      
#&gt; 
#&gt; $Bacon.risk.funs
#&gt; [1] "MeanAbsoluteDeviation" "Frequency"             "SharpeRatio"          
#&gt; [4] "MSquared"              "MSquaredExcess"        "HurstIndex"
```
]

---

.code75[

```r
tq_performance_fun_options()[10:14]  # 12 + 4 + 7 + 20 + 3
```

```
#&gt; $Bacon.regression.funs
#&gt;  [1] "CAPM.alpha"       "CAPM.beta"        "CAPM.epsilon"     "CAPM.jensenAlpha"
#&gt;  [5] "SystematicRisk"   "SpecificRisk"     "TotalRisk"        "TreynorRatio"    
#&gt;  [9] "AppraisalRatio"   "FamaBeta"         "Selectivity"      "NetSelectivity"  
#&gt; 
#&gt; $Bacon.relative.risk.funs
#&gt; [1] "ActivePremium"    "ActiveReturn"     "TrackingError"    "InformationRatio"
#&gt; 
#&gt; $Bacon.drawdown.funs
#&gt; [1] "PainIndex"     "PainRatio"     "CalmarRatio"   "SterlingRatio" "BurkeRatio"   
#&gt; [6] "MartinRatio"   "UlcerIndex"   
#&gt; 
#&gt; $Bacon.downside.risk.funs
#&gt;  [1] "DownsideDeviation"     "DownsidePotential"     "DownsideFrequency"    
#&gt;  [4] "SemiDeviation"         "SemiVariance"          "UpsideRisk"           
#&gt;  [7] "UpsidePotentialRatio"  "UpsideFrequency"       "BernardoLedoitRatio"  
#&gt; [10] "DRatio"                "Omega"                 "OmegaSharpeRatio"     
#&gt; [13] "OmegaExcessReturn"     "SortinoRatio"          "M2Sortino"            
#&gt; [16] "Kappa"                 "VolatilitySkewness"    "AdjustedSharpeRatio"  
#&gt; [19] "SkewnessKurtosisRatio" "ProspectRatio"        
#&gt; 
#&gt; $misc.funs
#&gt; [1] "KellyRatio"   "Modigliani"   "UpDownRatios"
```
]

---
layout: false

### &gt;&gt; `tidyquant`：vignettes &amp; .red[[{{business science blog}}](http://www.business-science.io/blog/index.html)]


```r
browseVignettes(package = 'tidyquant')

# tidyquant::TQ00-introduction-to-tidyquant
#   Introduction to tidyquant

# tidyquant::TQ01-core-functions-in-tidyquant
#   Core Functions in tidyquant

# tidyquant::TQ02-quant-integrations-in-tidyquant
#   R Quantitative Analysis Package Integrations in tidyquant

# tidyquant::TQ03-scaling-and-modeling-with-tidyquant
#   Scaling Your Analysis with tidyquant

# tidyquant::TQ04-charting-with-tidyquant
#   Charting with tidyquant

# tidyquant::TQ05-performance-analysis-with-tidyquant
#   Performance Analysis with tidyquant

*# tidyquant::TQ06-excel-in-r
*#   Excel in R - tidyquant 1.0.0
```

---

### &gt;&gt; `tidyquant`：[{{r for excel user}}](https://www.business-science.io/finance/2020/02/26/r-for-excel-users.html)

.pull-left[

```r
FANG %&gt;% 
  pivot_table(
    .row     = symbol, 
    .columns = ~ year(date),
    .values  = ~ PCT_CHANGE_FIRSTLAST(
                   adjusted)
  )
```

```
#&gt; # A tibble: 4 × 5
#&gt;   symbol `2013`  `2014` `2015` `2016`
#&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 AMZN    0.550 -0.220   1.19  0.177 
#&gt; 2 FB      0.952  0.426   0.334 0.126 
#&gt; 3 GOOG    0.550 -0.0532  0.446 0.0404
#&gt; 4 NFLX    3.00  -0.0585  1.29  0.126
```

&lt;br&gt;

.bold.font110[_emmmm_，`tidyquant::pivot_table()` 接口真香！🌹 😍]

]

--

.pull-right[

.bold.font110[当然，你也可以选择“呆在净土界”（stay in `tidyverse`），通过各式函数的管道组合来实现同样的结果！😎 👍]


```r
FANG %&gt;% 
  group_by(symbol, yr = year(date)) %&gt;% 
  summarise(ret = last(adjusted) / 
                  first(adjusted) - 1,
            .groups = "drop") %&gt;% 
  pivot_wider(id_cols     = symbol, 
              names_from  = yr, 
              values_from = ret)
```

```
#&gt; # A tibble: 4 × 5
#&gt;   symbol `2013`  `2014` `2015` `2016`
#&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 AMZN    0.550 -0.220   1.19  0.177 
#&gt; 2 FB      0.952  0.426   0.334 0.126 
#&gt; 3 GOOG    0.550 -0.0532  0.446 0.0404
#&gt; 4 NFLX    3.00  -0.0585  1.29  0.126
```
]

---
layout: false
class: inverse, center, middle
background-image: url(imgs/logo-tsibble.png), url(imgs/bg.png)
background-size: 10%, 100%
background-position: 22% 32%, 0% 100%

# 2. `tsibble` 包 &lt;sup&gt;.font60[v1.1.3]&lt;/sup&gt;

.font150[_Tidy Temporal Data Frames and Tools_]

.font120[&lt;br&gt;_Data Infrastructure for_ [{{`tidyverts`}}](https://github.com/tidyverts)]

---

### &gt;&gt; `tsibble` 包

.code90[

```r
library(tsibble)   # install.packages("tsibble")
```
]

--

.full-width[.content-box-blue.bold.font120[在 `tbl_ts` 数据结构中]]

1. **`key`** is a set of variables that define observational units over time.

2. **`index`** is a variable with inherent ordering from past to present.

3. Each observation should be uniquely identified by **`key`** and **`index`**.

4. Each observational unit should be measured at a common interval, if regularly spaced.

&lt;br&gt;
&lt;img src="imgs/tsibble-semantics.png" width="80%" style="display: block; margin: auto;" /&gt;

---

### &gt;&gt; `tsibble`：`as_tsibble()` 强制转化为`tbl_ts`

.code90[

```r
# 将数据集FANG转化为tbl_ts
data(FANG)  # 在tidyquant包中
class(FANG) # FANG is a tibble
```

```
#&gt; [1] "tbl_df"     "tbl"        "data.frame"
```
]

--

.code90[

```r
*FANG &lt;- as_tsibble(FANG, key = symbol, index = date)
# (x, key = NULL, index, regular = TRUE, validate = TRUE, .drop = TRUE, ...)
class(FANG) # now FANG is a tsibble
```

```
#&gt; [1] "tbl_ts"     "tbl_df"     "tbl"        "data.frame"
```
]

--

.code90[

```r
FANG
```

```
*#&gt; # A tsibble: 4,032 x 8 [1D]
*#&gt; # Key:       symbol [4]
#&gt;   symbol date        open  high   low close  volume adjusted
#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 AMZN   2013-01-02  256.  258.  253.  257. 3271000     257.
#&gt; 2 AMZN   2013-01-03  257.  261.  256.  258. 2750900     258.
#&gt; 3 AMZN   2013-01-04  258.  260.  257.  259. 1874200     259.
#&gt; # ℹ 4,029 more rows
```
]

---

### &gt;&gt; `tsibble`：`filter_index()` 选取时间子集

.code90[

```r
(FANG_2016 &lt;- FANG %&gt;% filter_index("2016"))
```

```
#&gt; # A tsibble: 1,008 x 8 [1D]
#&gt; # Key:       symbol [4]
#&gt;   symbol date        open  high   low close  volume adjusted
#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 AMZN   2016-01-04  656.  658.  628.  637. 9314500     637.
#&gt; 2 AMZN   2016-01-05  647.  647.  628.  634. 5822600     634.
#&gt; 3 AMZN   2016-01-06  622   640.  620.  633. 5329200     633.
#&gt; # ℹ 1,005 more rows
```

```r
FANG_2016 %&gt;% filter_index(~ "2016-01-05", "2016-12-29" ~ .)
```

```
#&gt; # A tsibble: 16 x 8 [1D]
#&gt; # Key:       symbol [4]
#&gt;   symbol date        open  high   low close  volume adjusted
#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 AMZN   2016-01-04  656.  658.  628.  637. 9314500     637.
#&gt; 2 AMZN   2016-01-05  647.  647.  628.  634. 5822600     634.
#&gt; 3 AMZN   2016-12-29  772.  773.  761.  765. 3153500     765.
#&gt; # ℹ 13 more rows
```
]

---

### &gt;&gt; `tsibble`：`index_by()` + `summarise()` 修改时间粒度

.pull-left.code80[

```r
FANG_2016 %&gt;% index_by()
```

```
#&gt; # A tsibble: 1,008 x 8 [1D]
#&gt; # Key:       symbol [4]
*#&gt; # Groups:    @ date [252]
#&gt;   symbol date        open  high   low
#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 AMZN   2016-01-04  656.  658.  628.
#&gt; 2 AMZN   2016-01-05  647.  647.  628.
#&gt; 3 AMZN   2016-01-06  622   640.  620.
#&gt; # ℹ 1,005 more rows
#&gt; # ℹ 3 more variables: close &lt;dbl&gt;,
#&gt; #   volume &lt;dbl&gt;, adjusted &lt;dbl&gt;
```


```r
FANG_2016 %&gt;% 
* group_by_key() %&gt;%
  index_by()
```

```
#&gt; # A tsibble: 1,008 x 8 [1D]
#&gt; # Key:       symbol [4]
*#&gt; # Groups:    symbol @ date [1,008]
#&gt;   symbol date        open  high   low
#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 AMZN   2016-01-04  656.  658.  628.
#&gt; 2 AMZN   2016-01-05  647.  647.  628.
#&gt; 3 AMZN   2016-01-06  622   640.  620.
#&gt; # ℹ 1,005 more rows
#&gt; # ℹ 3 more variables: close &lt;dbl&gt;,
#&gt; #   volume &lt;dbl&gt;, adjusted &lt;dbl&gt;
```
]

--

.pull-right.code90[

```r
FANG_2016 %&gt;% 
  group_by_key() %&gt;%
  index_by(
    bimonth = 
*     ~ floor_date(., "2 months")
  ) %&gt;% 
  summarise(
    HIGH = max(high),
    LOW = min(low)
  )
```

```
#&gt; # A tsibble: 24 x 4 [1D]
#&gt; # Key:       symbol [4]
#&gt;   symbol bimonth     HIGH   LOW
#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 AMZN   2016-01-01  658. 474  
#&gt; 2 AMZN   2016-03-01  670. 539. 
#&gt; 3 AMZN   2016-05-01  732. 656  
#&gt; 4 AMZN   2016-07-01  775. 717. 
#&gt; 5 AMZN   2016-09-01  847. 756  
#&gt; 6 AMZN   2016-11-01  801. 710. 
#&gt; 7 FB     2016-01-01  118.  89.4
#&gt; # ℹ 17 more rows
```
]

---

### &gt;&gt; `tsibble`：`*_gaps()` 检查、处理时间缺口

.code100[

```r
FANG_2016 %&gt;% count_gaps()
```

```
#&gt; # A tibble: 208 × 4
#&gt;    symbol .from      .to           .n
#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;date&gt;     &lt;int&gt;
#&gt;  1 AMZN   2016-01-09 2016-01-10     2
#&gt;  2 AMZN   2016-01-16 2016-01-18     3
#&gt;  3 AMZN   2016-01-23 2016-01-24     2
#&gt;  4 AMZN   2016-01-30 2016-01-31     2
#&gt;  5 AMZN   2016-02-06 2016-02-07     2
#&gt;  6 AMZN   2016-02-13 2016-02-15     3
#&gt;  7 AMZN   2016-02-20 2016-02-21     2
#&gt;  8 AMZN   2016-02-27 2016-02-28     2
#&gt;  9 AMZN   2016-03-05 2016-03-06     2
#&gt; 10 AMZN   2016-03-12 2016-03-13     2
#&gt; # ℹ 198 more rows
```

```r
# has_gaps() | scan_gaps() | fill_gaps()
```
]

---
layout: false
class: inverse, center, middle

# 3. `slider` 包 &lt;sup&gt;.font60[v0.3.1]&lt;/sup&gt;

.font150[_Sliding Window Functions_]

---
layout: true

### &gt;&gt; `slider` 包

---

.full-width[.content-box-blue.bold.font120[`purrr`-like Type-stable .red[Window Functions] Over Any R Data Type]]

--

&lt;img src="imgs/windows.png" width="100%" style="display: block; margin: auto;" /&gt;

---

.full-width[.content-box-blue.bold.font120[.red[`purrr`-like Type Stable] Window Functions Over Any R Data Type]]

.font110[
&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; list &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_lgl &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_int &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_dbl &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_chr &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_dfc &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_dfr &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; *_vec &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt; slide() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt; slide_index() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt; slide_period() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt; slide2() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt; slide_index2() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt; slide_period2() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt; pslide() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt; pslide_index() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt; pslide_period() &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; [p]hop*()    &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt; - &lt;/td&gt;
   &lt;td style="text-align:left;min-width: 3em; font-family: monospace;font-weight: bold;color: red !important;text-align: center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---
layout: true

### &gt;&gt; `slide(.x, .f, ..., .before = 0L, .after = 0L, .step = 1L, .complete = FALSE)`

---

.code90[

```r
*library(slider)
FANG_2016 %&gt;% 
  group_by_key() %&gt;%  # 等同于group_by(symbol)
  mutate(
*   ma5  = slide_dbl(adjusted, mean, .before = 4, .complete = TRUE),
*   ma20 = slide_dbl(adjusted, ~ mean(.x), .before = 19, .complete = TRUE)
  )
```

```
#&gt; # A tsibble: 1,008 x 10 [1D]
#&gt; # Key:       symbol [4]
#&gt; # Groups:    symbol [4]
#&gt;    symbol date        open  high   low close  volume adjusted   ma5  ma20
#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 AMZN   2016-01-04  656.  658.  628.  637. 9314500     637.   NA     NA
#&gt;  2 AMZN   2016-01-05  647.  647.  628.  634. 5822600     634.   NA     NA
#&gt;  3 AMZN   2016-01-06  622   640.  620.  633. 5329200     633.   NA     NA
#&gt;  4 AMZN   2016-01-07  622.  630   605.  608. 7074900     608.   NA     NA
#&gt;  5 AMZN   2016-01-08  620.  624.  606   607. 5512900     607.  624.    NA
#&gt;  6 AMZN   2016-01-11  612.  620.  599.  618. 4891600     618.  620.    NA
#&gt;  7 AMZN   2016-01-12  625.  626.  612.  618. 4724100     618.  617.    NA
#&gt;  8 AMZN   2016-01-13  621.  621.  579.  582. 7655200     582.  606.    NA
#&gt;  9 AMZN   2016-01-14  580.  602.  570.  593  7238000     593   603.    NA
#&gt; 10 AMZN   2016-01-15  572.  585.  565.  570. 7754500     570.  596.    NA
#&gt; # ℹ 998 more rows
```
]

---

.code90[

```r
FANG_2016 %&gt;% group_by_key() %&gt;% 
* mutate(ma20 = slide_dbl(adjusted, mean, .before = 19, .complete = TRUE)) %&gt;%
  ggplot(aes(x = date)) +
    geom_line(aes(y = adjusted)) +
    geom_line(aes(y = ma20), color = "red", linewidth = 1) +
    labs(x = "", y = "Adjusted Closing Price") + 
    facet_wrap(vars(symbol), ncol = 2, scales = "free_y") + theme_tq()
```

&lt;img src="L10_tidyquant_files/figure-html/unnamed-chunk-33-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---
layout: false

### &gt;&gt; `slide_index(.x, ` .bold.red[`.i,`] ` .f, ..., .before = 0L, .after = 0L, ` ~~`.step = 1L, `~~ `.complete = FALSE)` 🆚 `slide()`

.code90[

```r
FANG_2016 %&gt;% group_by_key() %&gt;% 
  mutate(
    ma5  = slide_dbl(adjusted, mean, .before = 4, .complete = TRUE),
    ma5d = slide_index_dbl(adjusted, date, mean, .before = 4,
                           .complete = TRUE)   # .before = days(4)
  )
```

```
#&gt; # A tsibble: 1,008 x 10 [1D]
#&gt; # Key:       symbol [4]
#&gt; # Groups:    symbol [4]
#&gt;    symbol date        open  high   low close  volume adjusted   ma5  ma5d
#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 AMZN   2016-01-04  656.  658.  628.  637. 9314500     637.   NA    NA 
#&gt;  2 AMZN   2016-01-05  647.  647.  628.  634. 5822600     634.   NA    NA 
#&gt;  3 AMZN   2016-01-06  622   640.  620.  633. 5329200     633.   NA    NA 
#&gt;  4 AMZN   2016-01-07  622.  630   605.  608. 7074900     608.   NA    NA 
#&gt;  5 AMZN   2016-01-08  620.  624.  606   607. 5512900     607.  624.  624.
*#&gt;  6 AMZN   2016-01-11  612.  620.  599.  618. 4891600     618.  620.  611.
*#&gt;  7 AMZN   2016-01-12  625.  626.  612.  618. 4724100     618.  617.  614.
*#&gt;  8 AMZN   2016-01-13  621.  621.  579.  582. 7655200     582.  606.  606.
*#&gt;  9 AMZN   2016-01-14  580.  602.  570.  593  7238000     593   603.  603.
#&gt; 10 AMZN   2016-01-15  572.  585.  565.  570. 7754500     570.  596.  596.
#&gt; # ℹ 998 more rows
```
]

---

### &gt;&gt; `slide_period(.x, .i, ` .red[`.period, `] `.f, ..., .every = 1L, .origin=NULL, .before=0L, .after=0L, .complete=FALSE)`

.pull-left.code90[

```r
i &lt;- c(as.Date("2019-08-30") + 0:2, 
       as.Date("2019-11-30") + 0:2)
i
```

```
#&gt; [1] "2019-08-30" "2019-08-31" "2019-09-01" "2019-11-30" "2019-12-01" "2019-12-02"
```

```r
slide_period(i, i, "month", ~ .x, 
             .before = 1)
```

```
#&gt; [[1]]
#&gt; [1] "2019-08-30" "2019-08-31"
#&gt; 
#&gt; [[2]]
#&gt; [1] "2019-08-30" "2019-08-31" "2019-09-01"
#&gt; 
#&gt; [[3]]
#&gt; [1] "2019-11-30"
#&gt; 
#&gt; [[4]]
#&gt; [1] "2019-11-30" "2019-12-01" "2019-12-02"
```
]

--

.pull-right.code90[

```r
sales &lt;- 1:6
sales_df &lt;- tibble(i = i, s = sales)

*bm_summary &lt;- function(data) {
* summarise(data, idx = max(i),
*           sales = sum(s))
*} 
slide_period_dfr(
  .x = sales_df, .i = sales_df$i,
  .period = "month", .before = 1,
* .f = bm_summary
)
```

```
#&gt; # A tibble: 4 × 2
#&gt;   idx        sales
#&gt;   &lt;date&gt;     &lt;int&gt;
#&gt; 1 2019-08-31     3
#&gt; 2 2019-09-01     6
#&gt; 3 2019-11-30     4
#&gt; 4 2019-12-02    15
```
]

---

### &gt;&gt; `hop(.x, ` .red[`.starts, .stops, `] `.f, ...)`

.pull-left.code90[

```r
jan_1st_2016 &lt;- floor_date(
  min(FANG_2016$date), "1 month"
)
jan_1st_2017 &lt;- ceiling_date(
  max(FANG_2016$date), "1 month"
)
dates &lt;- seq(jan_1st_2016, 
             jan_1st_2017, 
             "1 month")
(results &lt;- tibble(
  starts = dates[1:10],
  stops = dates[4:13] - 1
))
```

```
#&gt; # A tibble: 10 × 2
#&gt;   starts     stops     
#&gt;   &lt;date&gt;     &lt;date&gt;    
#&gt; 1 2016-01-01 2016-03-31
#&gt; 2 2016-02-01 2016-04-30
#&gt; 3 2016-03-01 2016-05-31
#&gt; # ℹ 7 more rows
```
]

--

.pull-right.code90[

```r
AMZN &lt;- FANG_2016 %&gt;% 
  filter(symbol == "AMZN")
results %&gt;%
  mutate(
*   total_volume = hop_index_vec(
      .x = AMZN$volume, 
      .i = AMZN$date,
      .starts = starts,
      .stops = stops,
      .f = sum,
      .ptype = double()
    )
  )
```

```
#&gt; # A tibble: 10 × 3
#&gt;   starts     stops      total_volume
#&gt;   &lt;date&gt;     &lt;date&gt;            &lt;dbl&gt;
#&gt; 1 2016-01-01 2016-03-31    348325200
#&gt; 2 2016-02-01 2016-04-30    296594000
#&gt; 3 2016-03-01 2016-05-31    263042800
#&gt; # ℹ 7 more rows
```
]

---
layout: false
class: inverse, center, middle

# 4. 案例：上证50成分股

.font150[_Case: SSE 50_]

---
layout: true

### &gt;&gt; 4.1 导入数据

---

.code90[

```r
# # 从_中证指数有限公司_官网得到“上证50”成分股列表并下载至本地
# SSE50_path &lt;- paste0(
#   "https://csi-web-dev.oss-cn-shanghai-finance-1-pub.aliyuncs.com/",
#   "static/html/csindex/public/uploads/file/autofile/cons/000016cons.xls")
# download.file(SSE50_path, "data/SSE50cons.xls", mode = "wb")
# 
# # 用readxl包的read_excel()读入
(SSE50_cons &lt;- readxl::read_excel(
    "data/SSE50cons.xls",  # 这是我2022年11月下载的成分股列表
    range = "E2:F51", 
    col_names = c("stk_cd", "stk_nm")
  ) %&gt;% 
  mutate(stk_cd = str_c(stk_cd, ".SH")))
```

```
#&gt; # A tibble: 50 × 2
#&gt;   stk_cd    stk_nm  
#&gt;   &lt;chr&gt;     &lt;chr&gt;   
#&gt; 1 600010.SH 包钢股份
#&gt; 2 600690.SH 海尔智家
#&gt; 3 600837.SH 海通证券
#&gt; # ℹ 47 more rows
```
]

---

.code80[

```r
# 利用WindR包提供的接口从Wind批量下载日行情数据，若同学没有Wind账号，可跳过此步
# 安装WindR包：Wind|开始|插件修复|修复R插件 ...
*if(!file.exists("data/SSE50_close.rds")) {
  library(WindR)
  w.start(showmenu = FALSE)
  
  bgn &lt;- "20190630"; end &lt;- "20230630"
  SSE50_close &lt;- SSE50_cons %&gt;% 
*   mutate(price = map(stk_cd, w.wsd, "close", bgn, end, 'Priceadj=F'))
  write_rds(SSE50_close, "data/SSE50_close.rds")
  
  w.stop()
}
```
]

.code80[

```r
#&gt; [1] "Welcome to use WIND Quant API for R (WindR)!"
#&gt; [1] "You can use w.menu to help yourself to create commands(WSD,WSS,WST,WSI,WSQ,...)!"
#&gt; [1] ""
#&gt; [1] "COPYRIGHT (C) 2013-2020 WIND INFORMATION CO., LTD. ALL RIGHTS RESERVED."
#&gt; [1] "IN NO CIRCUMSTANCE SHALL WIND BE RESPONSIBLE FOR ANY DAMAGES OR LOSSES CAUSED BY USING WIND QUANT API FOR R."
#&gt; $ErrorCode
#&gt; [1] 0
#&gt; 
#&gt; $ErrorMsg
#&gt; [1] "OK!"
```
]

---

.code90[

```r
(SSE50_close &lt;- read_rds("data/SSE50_close.rds"))
```

```
#&gt; # A tibble: 50 × 3
#&gt;   stk_cd    stk_nm   price           
#&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;list&gt;          
#&gt; 1 600010.SH 包钢股份 &lt;named list [3]&gt;
#&gt; 2 600690.SH 海尔智家 &lt;named list [3]&gt;
#&gt; 3 600837.SH 海通证券 &lt;named list [3]&gt;
#&gt; # ℹ 47 more rows
```

```r
# 将w.wsd()返回的列表解嵌套
(SSE50 &lt;- SSE50_close %&gt;% 
  unnest_wider(col = price) %&gt;%  # -&gt; ErrorCode, Data, Code
  filter(ErrorCode == 0) %&gt;% 
  unnest(cols = Data) %&gt;% 
  select(stk_cd, stk_nm, date = DATETIME, close = CLOSE))
```

```
#&gt; # A tibble: 48,600 × 4
#&gt;   stk_cd    stk_nm   date       close
#&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;     &lt;dbl&gt;
#&gt; 1 600010.SH 包钢股份 2019-07-01  1.69
#&gt; 2 600010.SH 包钢股份 2019-07-02  1.67
#&gt; 3 600010.SH 包钢股份 2019-07-03  1.65
#&gt; # ℹ 48,597 more rows
```
]

---
layout: true

### &gt;&gt; 4.2 数据转换

---

.code100[

```r
# 根据日收盘价变量close计算日收益率
SSE50_ret &lt;- SSE50 %&gt;% 
  group_by(stk_cd, stk_nm) %&gt;% 
  arrange(date, .by_group = TRUE) %&gt;%  # 在此非必须，谨慎起见可加上
  tq_transmute(
    select     = close, 
    mutate_fun = periodReturn, 
    period     = "daily", 
    col_rename = "Ra"
  )
SSE50_ret
```

```
#&gt; # A tibble: 47,279 × 4
#&gt; # Groups:   stk_cd, stk_nm [50]
#&gt;   stk_cd    stk_nm   date            Ra
#&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt;
#&gt; 1 600010.SH 包钢股份 2019-07-01  0     
#&gt; 2 600010.SH 包钢股份 2019-07-02 -0.0117
#&gt; 3 600010.SH 包钢股份 2019-07-03 -0.0118
#&gt; # ℹ 47,276 more rows
```
]

---
layout: true

### &gt;&gt; 4.3 数据分析

---

.code100[

```r
# 构建并计算等权重组合（作为基准组合）的收益率
n_stocks &lt;- SSE50_ret %&gt;% pull(stk_cd) %&gt;% unique() %&gt;% length()
wts &lt;- rep(1 / n_stocks, times = n_stocks)
baseline_ret &lt;- SSE50_ret %&gt;%
* tq_portfolio(  # -&gt; PerformanceAnalytics::Returns.portfolio()
    assets_col   = stk_cd, 
    returns_col  = Ra, 
    weights      = wts,  # 默认等权重，可不设定
    col_rename   = "Rb",
    rebalance_on = "months"  # ...
  )
baseline_ret
```

```
#&gt; # A tibble: 972 × 2
#&gt;   date              Rb
#&gt;   &lt;date&gt;         &lt;dbl&gt;
#&gt; 1 2019-07-01  0       
#&gt; 2 2019-07-02  0.000629
#&gt; 3 2019-07-03 -0.0103  
#&gt; # ℹ 969 more rows
```
]

---

.code90[

```r
# 合并收益率数据
SSE50_baseline &lt;- left_join(SSE50_ret, baseline_ret, by = "date")
# 基于CAPM的绩效评价结果
SSE50_capm &lt;- SSE50_baseline %&gt;% 
  tq_performance(
    Ra = Ra, 
*   Rb = Rb,
    performance_fun = table.CAPM
  ) %&gt;% 
  arrange(desc(AnnualizedAlpha))
SSE50_capm
```

```
#&gt; # A tibble: 50 × 14
#&gt; # Groups:   stk_cd, stk_nm [50]
#&gt;   stk_cd    stk_nm  ActivePremium  Alpha AnnualizedAlpha  Beta `Beta-` `Beta+` Correlation
#&gt;   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 600905.SH 三峡能…         0.245 0.0011           0.323 0.666   0.932   0.192       0.293
#&gt; 2 600809.SH 山西汾…         0.255 0.001            0.291 1.16    1.33    0.890       0.492
#&gt; 3 601919.SH 中远海…         0.217 0.0009           0.267 1.23    1.40    1.03        0.476
#&gt; # ℹ 47 more rows
#&gt; # ℹ 5 more variables: `Correlationp-value` &lt;dbl&gt;, InformationRatio &lt;dbl&gt;,
#&gt; #   `R-squared` &lt;dbl&gt;, TrackingError &lt;dbl&gt;, TreynorRatio &lt;dbl&gt;
```
]

---

.code90[

```r
# 年化Alpha最大的股票
tgt_stk &lt;- SSE50_capm$stk_cd[[1]]
# 计算动态相关系数
tgt_cor &lt;- SSE50_baseline %&gt;% 
  filter(stk_cd %in% tgt_stk) %&gt;% 
  as_tsibble(index = date) %&gt;%  # 有助于保证排序正确，且无重复样本
  mutate(
    cor = slide2_dbl(
      Ra, Rb, 
      ~ cor(.x, .y, use = "pairwise.complete.obs"),
      .before = 40,
      .complete = TRUE
    )
  )
tgt_cor %&gt;% tail()
```

```
#&gt; # A tsibble: 6 x 6 [1D]
#&gt; # Groups:    stk_cd, stk_nm [1]
#&gt;   stk_cd    stk_nm   date            Ra       Rb   cor
#&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 600905.SH 三峡能源 2023-06-21 0       -0.0145  0.416
#&gt; 2 600905.SH 三峡能源 2023-06-26 0.00758 -0.0129  0.356
#&gt; 3 600905.SH 三峡能源 2023-06-27 0        0.00650 0.358
#&gt; # ℹ 3 more rows
```
]

---

&lt;style type="text/css"&gt;
/*https://stackoverflow.com/questions/53687947/centering-a-dygraph-plot-in-r-markdown*/
.html-widget {
    margin: auto;
}
&lt;/style&gt;

.code90[

```r
# 用 dygraphs 包作交互图（其它如 plotly、echarts4r, highcharter、rbokeh 等）
library(dygraphs)
tgt_cor %&gt;%  
  as_tibble() %&gt;%  # 转成tibble
* timetk::tk_xts(select = cor, date_var = date) %&gt;%  # 转成dygraphs支持更好的xts
  dygraph(main = glue::glue("Correlation between {tgt_stk} and Baseline")) %&gt;%
  dyAxis("y", label = "Correlation") %&gt;%
  dyRangeSelector(height = 25)
```

<div class="dygraphs html-widget html-fill-item" id="htmlwidget-4902c27f6c5dee96c2f6" style="width:75%;height:300px;"></div>
<script type="application/json" data-for="htmlwidget-4902c27f6c5dee96c2f6">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60},"y":[]},"title":"Correlation between 600905.SH and Baseline","labels":["day","cor"],"legend":"auto","retainDateWindow":false,"ylabel":"Correlation","showRangeSelector":true,"rangeSelectorHeight":25,"rangeSelectorPlotFillColor":" #A7B1C4","rangeSelectorPlotStrokeColor":"#808FAB","interactionModel":"Dygraph.Interaction.defaultModel"},"scale":"daily","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2021-06-10T00:00:00.000Z","2021-06-11T00:00:00.000Z","2021-06-15T00:00:00.000Z","2021-06-16T00:00:00.000Z","2021-06-17T00:00:00.000Z","2021-06-18T00:00:00.000Z","2021-06-21T00:00:00.000Z","2021-06-22T00:00:00.000Z","2021-06-23T00:00:00.000Z","2021-06-24T00:00:00.000Z","2021-06-25T00:00:00.000Z","2021-06-28T00:00:00.000Z","2021-06-29T00:00:00.000Z","2021-06-30T00:00:00.000Z","2021-07-01T00:00:00.000Z","2021-07-02T00:00:00.000Z","2021-07-05T00:00:00.000Z","2021-07-06T00:00:00.000Z","2021-07-07T00:00:00.000Z","2021-07-08T00:00:00.000Z","2021-07-09T00:00:00.000Z","2021-07-12T00:00:00.000Z","2021-07-13T00:00:00.000Z","2021-07-14T00:00:00.000Z","2021-07-15T00:00:00.000Z","2021-07-16T00:00:00.000Z","2021-07-19T00:00:00.000Z","2021-07-20T00:00:00.000Z","2021-07-21T00:00:00.000Z","2021-07-22T00:00:00.000Z","2021-07-23T00:00:00.000Z","2021-07-26T00:00:00.000Z","2021-07-27T00:00:00.000Z","2021-07-28T00:00:00.000Z","2021-07-29T00:00:00.000Z","2021-07-30T00:00:00.000Z","2021-08-02T00:00:00.000Z","2021-08-03T00:00:00.000Z","2021-08-04T00:00:00.000Z","2021-08-05T00:00:00.000Z","2021-08-06T00:00:00.000Z","2021-08-09T00:00:00.000Z","2021-08-10T00:00:00.000Z","2021-08-11T00:00:00.000Z","2021-08-12T00:00:00.000Z","2021-08-13T00:00:00.000Z","2021-08-16T00:00:00.000Z","2021-08-17T00:00:00.000Z","2021-08-18T00:00:00.000Z","2021-08-19T00:00:00.000Z","2021-08-20T00:00:00.000Z","2021-08-23T00:00:00.000Z","2021-08-24T00:00:00.000Z","2021-08-25T00:00:00.000Z","2021-08-26T00:00:00.000Z","2021-08-27T00:00:00.000Z","2021-08-30T00:00:00.000Z","2021-08-31T00:00:00.000Z","2021-09-01T00:00:00.000Z","2021-09-02T00:00:00.000Z","2021-09-03T00:00:00.000Z","2021-09-06T00:00:00.000Z","2021-09-07T00:00:00.000Z","2021-09-08T00:00:00.000Z","2021-09-09T00:00:00.000Z","2021-09-10T00:00:00.000Z","2021-09-13T00:00:00.000Z","2021-09-14T00:00:00.000Z","2021-09-15T00:00:00.000Z","2021-09-16T00:00:00.000Z","2021-09-17T00:00:00.000Z","2021-09-22T00:00:00.000Z","2021-09-23T00:00:00.000Z","2021-09-24T00:00:00.000Z","2021-09-27T00:00:00.000Z","2021-09-28T00:00:00.000Z","2021-09-29T00:00:00.000Z","2021-09-30T00:00:00.000Z","2021-10-08T00:00:00.000Z","2021-10-11T00:00:00.000Z","2021-10-12T00:00:00.000Z","2021-10-13T00:00:00.000Z","2021-10-14T00:00:00.000Z","2021-10-15T00:00:00.000Z","2021-10-18T00:00:00.000Z","2021-10-19T00:00:00.000Z","2021-10-20T00:00:00.000Z","2021-10-21T00:00:00.000Z","2021-10-22T00:00:00.000Z","2021-10-25T00:00:00.000Z","2021-10-26T00:00:00.000Z","2021-10-27T00:00:00.000Z","2021-10-28T00:00:00.000Z","2021-10-29T00:00:00.000Z","2021-11-01T00:00:00.000Z","2021-11-02T00:00:00.000Z","2021-11-03T00:00:00.000Z","2021-11-04T00:00:00.000Z","2021-11-05T00:00:00.000Z","2021-11-08T00:00:00.000Z","2021-11-09T00:00:00.000Z","2021-11-10T00:00:00.000Z","2021-11-11T00:00:00.000Z","2021-11-12T00:00:00.000Z","2021-11-15T00:00:00.000Z","2021-11-16T00:00:00.000Z","2021-11-17T00:00:00.000Z","2021-11-18T00:00:00.000Z","2021-11-19T00:00:00.000Z","2021-11-22T00:00:00.000Z","2021-11-23T00:00:00.000Z","2021-11-24T00:00:00.000Z","2021-11-25T00:00:00.000Z","2021-11-26T00:00:00.000Z","2021-11-29T00:00:00.000Z","2021-11-30T00:00:00.000Z","2021-12-01T00:00:00.000Z","2021-12-02T00:00:00.000Z","2021-12-03T00:00:00.000Z","2021-12-06T00:00:00.000Z","2021-12-07T00:00:00.000Z","2021-12-08T00:00:00.000Z","2021-12-09T00:00:00.000Z","2021-12-10T00:00:00.000Z","2021-12-13T00:00:00.000Z","2021-12-14T00:00:00.000Z","2021-12-15T00:00:00.000Z","2021-12-16T00:00:00.000Z","2021-12-17T00:00:00.000Z","2021-12-20T00:00:00.000Z","2021-12-21T00:00:00.000Z","2021-12-22T00:00:00.000Z","2021-12-23T00:00:00.000Z","2021-12-24T00:00:00.000Z","2021-12-27T00:00:00.000Z","2021-12-28T00:00:00.000Z","2021-12-29T00:00:00.000Z","2021-12-30T00:00:00.000Z","2021-12-31T00:00:00.000Z","2022-01-04T00:00:00.000Z","2022-01-05T00:00:00.000Z","2022-01-06T00:00:00.000Z","2022-01-07T00:00:00.000Z","2022-01-10T00:00:00.000Z","2022-01-11T00:00:00.000Z","2022-01-12T00:00:00.000Z","2022-01-13T00:00:00.000Z","2022-01-14T00:00:00.000Z","2022-01-17T00:00:00.000Z","2022-01-18T00:00:00.000Z","2022-01-19T00:00:00.000Z","2022-01-20T00:00:00.000Z","2022-01-21T00:00:00.000Z","2022-01-24T00:00:00.000Z","2022-01-25T00:00:00.000Z","2022-01-26T00:00:00.000Z","2022-01-27T00:00:00.000Z","2022-01-28T00:00:00.000Z","2022-02-07T00:00:00.000Z","2022-02-08T00:00:00.000Z","2022-02-09T00:00:00.000Z","2022-02-10T00:00:00.000Z","2022-02-11T00:00:00.000Z","2022-02-14T00:00:00.000Z","2022-02-15T00:00:00.000Z","2022-02-16T00:00:00.000Z","2022-02-17T00:00:00.000Z","2022-02-18T00:00:00.000Z","2022-02-21T00:00:00.000Z","2022-02-22T00:00:00.000Z","2022-02-23T00:00:00.000Z","2022-02-24T00:00:00.000Z","2022-02-25T00:00:00.000Z","2022-02-28T00:00:00.000Z","2022-03-01T00:00:00.000Z","2022-03-02T00:00:00.000Z","2022-03-03T00:00:00.000Z","2022-03-04T00:00:00.000Z","2022-03-07T00:00:00.000Z","2022-03-08T00:00:00.000Z","2022-03-09T00:00:00.000Z","2022-03-10T00:00:00.000Z","2022-03-11T00:00:00.000Z","2022-03-14T00:00:00.000Z","2022-03-15T00:00:00.000Z","2022-03-16T00:00:00.000Z","2022-03-17T00:00:00.000Z","2022-03-18T00:00:00.000Z","2022-03-21T00:00:00.000Z","2022-03-22T00:00:00.000Z","2022-03-23T00:00:00.000Z","2022-03-24T00:00:00.000Z","2022-03-25T00:00:00.000Z","2022-03-28T00:00:00.000Z","2022-03-29T00:00:00.000Z","2022-03-30T00:00:00.000Z","2022-03-31T00:00:00.000Z","2022-04-01T00:00:00.000Z","2022-04-06T00:00:00.000Z","2022-04-07T00:00:00.000Z","2022-04-08T00:00:00.000Z","2022-04-11T00:00:00.000Z","2022-04-12T00:00:00.000Z","2022-04-13T00:00:00.000Z","2022-04-14T00:00:00.000Z","2022-04-15T00:00:00.000Z","2022-04-18T00:00:00.000Z","2022-04-19T00:00:00.000Z","2022-04-20T00:00:00.000Z","2022-04-21T00:00:00.000Z","2022-04-22T00:00:00.000Z","2022-04-25T00:00:00.000Z","2022-04-26T00:00:00.000Z","2022-04-27T00:00:00.000Z","2022-04-28T00:00:00.000Z","2022-04-29T00:00:00.000Z","2022-05-05T00:00:00.000Z","2022-05-06T00:00:00.000Z","2022-05-09T00:00:00.000Z","2022-05-10T00:00:00.000Z","2022-05-11T00:00:00.000Z","2022-05-12T00:00:00.000Z","2022-05-13T00:00:00.000Z","2022-05-16T00:00:00.000Z","2022-05-17T00:00:00.000Z","2022-05-18T00:00:00.000Z","2022-05-19T00:00:00.000Z","2022-05-20T00:00:00.000Z","2022-05-23T00:00:00.000Z","2022-05-24T00:00:00.000Z","2022-05-25T00:00:00.000Z","2022-05-26T00:00:00.000Z","2022-05-27T00:00:00.000Z","2022-05-30T00:00:00.000Z","2022-05-31T00:00:00.000Z","2022-06-01T00:00:00.000Z","2022-06-02T00:00:00.000Z","2022-06-06T00:00:00.000Z","2022-06-07T00:00:00.000Z","2022-06-08T00:00:00.000Z","2022-06-09T00:00:00.000Z","2022-06-10T00:00:00.000Z","2022-06-13T00:00:00.000Z","2022-06-14T00:00:00.000Z","2022-06-15T00:00:00.000Z","2022-06-16T00:00:00.000Z","2022-06-17T00:00:00.000Z","2022-06-20T00:00:00.000Z","2022-06-21T00:00:00.000Z","2022-06-22T00:00:00.000Z","2022-06-23T00:00:00.000Z","2022-06-24T00:00:00.000Z","2022-06-27T00:00:00.000Z","2022-06-28T00:00:00.000Z","2022-06-29T00:00:00.000Z","2022-06-30T00:00:00.000Z","2022-07-01T00:00:00.000Z","2022-07-04T00:00:00.000Z","2022-07-05T00:00:00.000Z","2022-07-06T00:00:00.000Z","2022-07-07T00:00:00.000Z","2022-07-08T00:00:00.000Z","2022-07-11T00:00:00.000Z","2022-07-12T00:00:00.000Z","2022-07-13T00:00:00.000Z","2022-07-14T00:00:00.000Z","2022-07-15T00:00:00.000Z","2022-07-18T00:00:00.000Z","2022-07-19T00:00:00.000Z","2022-07-20T00:00:00.000Z","2022-07-21T00:00:00.000Z","2022-07-22T00:00:00.000Z","2022-07-25T00:00:00.000Z","2022-07-26T00:00:00.000Z","2022-07-27T00:00:00.000Z","2022-07-28T00:00:00.000Z","2022-07-29T00:00:00.000Z","2022-08-01T00:00:00.000Z","2022-08-02T00:00:00.000Z","2022-08-03T00:00:00.000Z","2022-08-04T00:00:00.000Z","2022-08-05T00:00:00.000Z","2022-08-08T00:00:00.000Z","2022-08-09T00:00:00.000Z","2022-08-10T00:00:00.000Z","2022-08-11T00:00:00.000Z","2022-08-12T00:00:00.000Z","2022-08-15T00:00:00.000Z","2022-08-16T00:00:00.000Z","2022-08-17T00:00:00.000Z","2022-08-18T00:00:00.000Z","2022-08-19T00:00:00.000Z","2022-08-22T00:00:00.000Z","2022-08-23T00:00:00.000Z","2022-08-24T00:00:00.000Z","2022-08-25T00:00:00.000Z","2022-08-26T00:00:00.000Z","2022-08-29T00:00:00.000Z","2022-08-30T00:00:00.000Z","2022-08-31T00:00:00.000Z","2022-09-01T00:00:00.000Z","2022-09-02T00:00:00.000Z","2022-09-05T00:00:00.000Z","2022-09-06T00:00:00.000Z","2022-09-07T00:00:00.000Z","2022-09-08T00:00:00.000Z","2022-09-09T00:00:00.000Z","2022-09-13T00:00:00.000Z","2022-09-14T00:00:00.000Z","2022-09-15T00:00:00.000Z","2022-09-16T00:00:00.000Z","2022-09-19T00:00:00.000Z","2022-09-20T00:00:00.000Z","2022-09-21T00:00:00.000Z","2022-09-22T00:00:00.000Z","2022-09-23T00:00:00.000Z","2022-09-26T00:00:00.000Z","2022-09-27T00:00:00.000Z","2022-09-28T00:00:00.000Z","2022-09-29T00:00:00.000Z","2022-09-30T00:00:00.000Z","2022-10-10T00:00:00.000Z","2022-10-11T00:00:00.000Z","2022-10-12T00:00:00.000Z","2022-10-13T00:00:00.000Z","2022-10-14T00:00:00.000Z","2022-10-17T00:00:00.000Z","2022-10-18T00:00:00.000Z","2022-10-19T00:00:00.000Z","2022-10-20T00:00:00.000Z","2022-10-21T00:00:00.000Z","2022-10-24T00:00:00.000Z","2022-10-25T00:00:00.000Z","2022-10-26T00:00:00.000Z","2022-10-27T00:00:00.000Z","2022-10-28T00:00:00.000Z","2022-10-31T00:00:00.000Z","2022-11-01T00:00:00.000Z","2022-11-02T00:00:00.000Z","2022-11-03T00:00:00.000Z","2022-11-04T00:00:00.000Z","2022-11-07T00:00:00.000Z","2022-11-08T00:00:00.000Z","2022-11-09T00:00:00.000Z","2022-11-10T00:00:00.000Z","2022-11-11T00:00:00.000Z","2022-11-14T00:00:00.000Z","2022-11-15T00:00:00.000Z","2022-11-16T00:00:00.000Z","2022-11-17T00:00:00.000Z","2022-11-18T00:00:00.000Z","2022-11-21T00:00:00.000Z","2022-11-22T00:00:00.000Z","2022-11-23T00:00:00.000Z","2022-11-24T00:00:00.000Z","2022-11-25T00:00:00.000Z","2022-11-28T00:00:00.000Z","2022-11-29T00:00:00.000Z","2022-11-30T00:00:00.000Z","2022-12-01T00:00:00.000Z","2022-12-02T00:00:00.000Z","2022-12-05T00:00:00.000Z","2022-12-06T00:00:00.000Z","2022-12-07T00:00:00.000Z","2022-12-08T00:00:00.000Z","2022-12-09T00:00:00.000Z","2022-12-12T00:00:00.000Z","2022-12-13T00:00:00.000Z","2022-12-14T00:00:00.000Z","2022-12-15T00:00:00.000Z","2022-12-16T00:00:00.000Z","2022-12-19T00:00:00.000Z","2022-12-20T00:00:00.000Z","2022-12-21T00:00:00.000Z","2022-12-22T00:00:00.000Z","2022-12-23T00:00:00.000Z","2022-12-26T00:00:00.000Z","2022-12-27T00:00:00.000Z","2022-12-28T00:00:00.000Z","2022-12-29T00:00:00.000Z","2022-12-30T00:00:00.000Z","2023-01-03T00:00:00.000Z","2023-01-04T00:00:00.000Z","2023-01-05T00:00:00.000Z","2023-01-06T00:00:00.000Z","2023-01-09T00:00:00.000Z","2023-01-10T00:00:00.000Z","2023-01-11T00:00:00.000Z","2023-01-12T00:00:00.000Z","2023-01-13T00:00:00.000Z","2023-01-16T00:00:00.000Z","2023-01-17T00:00:00.000Z","2023-01-18T00:00:00.000Z","2023-01-19T00:00:00.000Z","2023-01-20T00:00:00.000Z","2023-01-30T00:00:00.000Z","2023-01-31T00:00:00.000Z","2023-02-01T00:00:00.000Z","2023-02-02T00:00:00.000Z","2023-02-03T00:00:00.000Z","2023-02-06T00:00:00.000Z","2023-02-07T00:00:00.000Z","2023-02-08T00:00:00.000Z","2023-02-09T00:00:00.000Z","2023-02-10T00:00:00.000Z","2023-02-13T00:00:00.000Z","2023-02-14T00:00:00.000Z","2023-02-15T00:00:00.000Z","2023-02-16T00:00:00.000Z","2023-02-17T00:00:00.000Z","2023-02-20T00:00:00.000Z","2023-02-21T00:00:00.000Z","2023-02-22T00:00:00.000Z","2023-02-23T00:00:00.000Z","2023-02-24T00:00:00.000Z","2023-02-27T00:00:00.000Z","2023-02-28T00:00:00.000Z","2023-03-01T00:00:00.000Z","2023-03-02T00:00:00.000Z","2023-03-03T00:00:00.000Z","2023-03-06T00:00:00.000Z","2023-03-07T00:00:00.000Z","2023-03-08T00:00:00.000Z","2023-03-09T00:00:00.000Z","2023-03-10T00:00:00.000Z","2023-03-13T00:00:00.000Z","2023-03-14T00:00:00.000Z","2023-03-15T00:00:00.000Z","2023-03-16T00:00:00.000Z","2023-03-17T00:00:00.000Z","2023-03-20T00:00:00.000Z","2023-03-21T00:00:00.000Z","2023-03-22T00:00:00.000Z","2023-03-23T00:00:00.000Z","2023-03-24T00:00:00.000Z","2023-03-27T00:00:00.000Z","2023-03-28T00:00:00.000Z","2023-03-29T00:00:00.000Z","2023-03-30T00:00:00.000Z","2023-03-31T00:00:00.000Z","2023-04-03T00:00:00.000Z","2023-04-04T00:00:00.000Z","2023-04-06T00:00:00.000Z","2023-04-07T00:00:00.000Z","2023-04-10T00:00:00.000Z","2023-04-11T00:00:00.000Z","2023-04-12T00:00:00.000Z","2023-04-13T00:00:00.000Z","2023-04-14T00:00:00.000Z","2023-04-17T00:00:00.000Z","2023-04-18T00:00:00.000Z","2023-04-19T00:00:00.000Z","2023-04-20T00:00:00.000Z","2023-04-21T00:00:00.000Z","2023-04-24T00:00:00.000Z","2023-04-25T00:00:00.000Z","2023-04-26T00:00:00.000Z","2023-04-27T00:00:00.000Z","2023-04-28T00:00:00.000Z","2023-05-04T00:00:00.000Z","2023-05-05T00:00:00.000Z","2023-05-08T00:00:00.000Z","2023-05-09T00:00:00.000Z","2023-05-10T00:00:00.000Z","2023-05-11T00:00:00.000Z","2023-05-12T00:00:00.000Z","2023-05-15T00:00:00.000Z","2023-05-16T00:00:00.000Z","2023-05-17T00:00:00.000Z","2023-05-18T00:00:00.000Z","2023-05-19T00:00:00.000Z","2023-05-22T00:00:00.000Z","2023-05-23T00:00:00.000Z","2023-05-24T00:00:00.000Z","2023-05-25T00:00:00.000Z","2023-05-26T00:00:00.000Z","2023-05-29T00:00:00.000Z","2023-05-30T00:00:00.000Z","2023-05-31T00:00:00.000Z","2023-06-01T00:00:00.000Z","2023-06-02T00:00:00.000Z","2023-06-05T00:00:00.000Z","2023-06-06T00:00:00.000Z","2023-06-07T00:00:00.000Z","2023-06-08T00:00:00.000Z","2023-06-09T00:00:00.000Z","2023-06-12T00:00:00.000Z","2023-06-13T00:00:00.000Z","2023-06-14T00:00:00.000Z","2023-06-15T00:00:00.000Z","2023-06-16T00:00:00.000Z","2023-06-19T00:00:00.000Z","2023-06-20T00:00:00.000Z","2023-06-21T00:00:00.000Z","2023-06-26T00:00:00.000Z","2023-06-27T00:00:00.000Z","2023-06-28T00:00:00.000Z","2023-06-29T00:00:00.000Z","2023-06-30T00:00:00.000Z"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.02286549419478406,0.01749161802223433,0.02669019048902522,0.06346226241942407,0.1163857302615455,0.1058863749664656,0.08881948532200087,0.1247522462091011,0.05850595755881727,0.02210123350453732,0.01800983613208874,0.06944076752975466,0.05724944913137434,0.08027204837701805,0.1289313935891518,0.1349013475355859,0.06222191159954841,0.06797008735915146,0.07876427847347034,0.07229999619356264,0.06923511708973358,0.0421384996289156,0.08499834070676222,0.07481581189774639,0.05256515493416228,0.07703108182552129,0.0817592963742816,0.1209369986452611,0.09360335749176962,0.1280966838593794,0.1678173791204773,0.1454963248354171,0.1000891939606105,0.1716053427877297,0.1615850291621627,0.188224937974813,0.232807747731264,0.2772880903277881,0.2393159043880713,0.2263319531905997,0.2334676704314154,0.2120654268180035,0.2184932257466621,0.2309943640133699,0.2153256636855584,0.2020886775676653,0.1884786083349349,0.1846136158571444,0.1506613704629507,0.1798937588594821,0.1798811417756219,0.124918130840972,0.126578476290534,0.1320402007698033,0.09912908629586283,0.09621242586077614,0.1030620847977558,0.1117557729798113,0.1441097236800424,0.1441533495758829,0.1413647080792665,0.1713793122233223,0.1650166244180787,0.1465051620109112,0.1531578761528046,0.1543466687006397,0.1754268871188257,0.1623028749075711,0.1153840204801405,0.1346039189999297,0.1099959050464693,0.03435948802480501,0.0244042919010057,0.05205630118571575,0.06265275349359127,0.05151636526558096,-0.00960898881654141,-0.1251947060637045,-0.1180301388784293,-0.07298202674066669,-0.07239771827319219,-0.06183456861267648,0.01193215961630223,0.03063857829926324,0.05020485616671694,0.08243032576294387,0.103965880941413,0.1173022359682237,0.09968265706365699,0.1458495678327573,0.1338633036192553,0.1446198357568698,0.2428303667571443,0.2185957555032314,0.2234355418935351,0.2767105647713897,0.2794265690278858,0.2753689782443093,0.2700045119798368,0.2415986150921504,0.2800712301484682,0.2857197098201311,0.2817875699488721,0.3573409945902047,0.3710883700801818,0.3617517433841923,0.349208792216496,0.3564180436389897,0.3911942727354054,0.4404604856237477,0.453720137493357,0.4638041607974356,0.4761970902567982,0.477181185357785,0.5377211134400295,0.5456265574811464,0.5031958797412045,0.4457413571070671,0.4589727759578533,0.4441210506616712,0.4474493154606344,0.4579121261974439,0.4386495842866108,0.4292658479298556,0.4281030625792161,0.4127256652420498,0.4205293842848762,0.418291122756025,0.416634172139724,0.459666206836193,0.4551143919738314,0.4645596280136414,0.4748166303977698,0.4789654972752497,0.5359131911532812,0.5428771354081794,0.5890926591383759,0.564955600739585,0.5771881463249954,0.59762281267201,0.5924343875412341,0.6163934012448845,0.6041960065044718,0.6475440565702881,0.7460634226840375,0.7602079590972923,0.7622903904471993,0.7730379416488512,0.7708956445012131,0.7664174908508358,0.7608871883355346,0.7622310604387535,0.7632434914360354,0.7622140619156638,0.773111008792849,0.7560071533976251,0.7550079585274874,0.7790533693908384,0.8057181029306119,0.8144588792909722,0.8154442219821268,0.8236789440246471,0.812018585596142,0.8063199230531877,0.7767534168466119,0.7751577729990763,0.7560593966208906,0.7501385128640107,0.7525030290693604,0.760708874417283,0.7575023581651977,0.7592160226286165,0.7530176234209957,0.7707598865088732,0.770148469186088,0.7887750947091271,0.7893140674881337,0.7915430701582195,0.7932420179892872,0.7876281284860749,0.7841541267170856,0.7889763751029381,0.7849924354906831,0.7814470931208055,0.7573171314226732,0.6953492792940432,0.6511877162928037,0.6425725490683543,0.6361490549934982,0.6551656153330941,0.6565272988117183,0.6572836801673735,0.6515517592645655,0.6410970000519579,0.6476390452927508,0.6487724090706428,0.6511809088426149,0.6537739062744686,0.6553635183103881,0.6704653390152649,0.6652724576945575,0.6737001455479128,0.6531990594623943,0.6686494371153808,0.6640664344256789,0.7048565937885792,0.6963893067864475,0.7057111683940607,0.7099177748111309,0.7083544093883813,0.6805543940446853,0.6753194494388854,0.5721089115415788,0.5228431804889462,0.5156637954000374,0.4952538452186853,0.4277991072739287,0.4208876894394544,0.3697318648943025,0.3550019881387125,0.3600035592133718,0.3494629552706816,0.2290158404838226,0.2364679693914657,0.2180830639253124,0.2598551680964206,0.3155037699595089,0.3697250618758352,0.3754389092454344,0.3721722016367152,0.3367037431406044,0.330990831345773,0.3363446376958488,0.3404354440790139,0.3510134710665794,0.3357847783399399,0.316169762401555,0.3160670729969906,0.3417381455709598,0.3481155487825049,0.3575816213687888,0.3466844431214202,0.3269460681058932,0.3138253041023343,0.3065303400389809,0.3420901254677093,0.3323505279947425,0.3311724250344494,0.3245864828642357,0.3431637792693593,0.3369908733475189,0.3219668577937306,0.3359112149111232,0.4052545835852513,0.401027114384805,0.3952093642311439,0.4335272735398761,0.4321654817053047,0.4211106773177684,0.3889711933958319,0.4160960396627479,0.4132706419608014,0.4122351860065312,0.5393999587937057,0.5411154384174318,0.5872259353129001,0.5949403699776106,0.5552239284629457,0.502402809707588,0.5096195201909983,0.5793901233295136,0.5646469095918955,0.5635308571634907,0.558108293979621,0.5522417843306202,0.5453222209060011,0.5610273169064752,0.6185123963083974,0.6331725380904277,0.6023179656256872,0.5978629500537214,0.5576702531683596,0.5703638530280701,0.581558766324385,0.5855943416348129,0.5734350718973337,0.5710115326272858,0.5721789432720092,0.5741021742082991,0.5860753810219145,0.5656688563418173,0.5855066897022112,0.6169022843339131,0.6323118103148456,0.592125351031331,0.6195482621651028,0.6091417749238,0.6465209740860046,0.6436346236201366,0.6533260094583015,0.6895795951018022,0.6859598784812296,0.6919878202039677,0.6963744913002592,0.6903908511450416,0.6875994246415479,0.6860229427807084,0.6979789041869736,0.6974140859293069,0.6928602671108256,0.694182598212266,0.6595100063438295,0.6599486118646003,0.6667673451329764,0.6672852198167732,0.6704273348071461,0.6700888988845219,0.6350767643930872,0.6284646941856448,0.5997580316302379,0.590838115519142,0.6078168679497323,0.6185338024596523,0.6543617085330738,0.6474835961307402,0.6493799469606388,0.6467064632416188,0.6664817804551414,0.661833766275128,0.6671199658417257,0.6637497368940614,0.6886108556558332,0.660362255060836,0.6589507341184644,0.6569566327689762,0.7003406309803586,0.6563428535411323,0.6557177938747059,0.4567665279338592,0.4561242984598104,0.4276969341096702,0.3307125032719517,0.331146324519176,0.3269795779948187,0.3049231274895974,0.2849939319846658,0.2667206042459137,0.2731449163134764,0.2520586097135538,0.2420793633659841,0.2416442361877177,0.2337695284277348,0.2195401497012201,0.2090106573245694,0.2236745859858951,0.2257647089161206,0.230757629656154,0.2343708927090354,0.2505070912298695,0.2831080738547764,0.2660786073976305,0.2807106961985855,0.2692882572310865,0.2812531171934678,0.2424024289419328,0.2349490441652006,0.2245195554921072,0.2125816586375724,0.2252326767020627,0.2470159785044575,0.2839277132728208,0.2810906010465393,0.2450402283744253,0.2320537122707228,0.2439756557117726,0.2482541710303967,0.2521881769135888,0.2867292137496675,0.2834580143956247,0.3546083299439864,0.374536499674701,0.3915529441859525,0.4559089564048123,0.4659087726964052,0.4697819929595514,0.5479604534727889,0.5857929875642975,0.583767444744278,0.6079141406611008,0.6142266254882077,0.6419822701956037,0.6451803246698631,0.6587217321164055,0.6728833751356682,0.6956555984843086,0.6839444506566629,0.6839664277468304,0.6786759925836036,0.6368165497552285,0.6386161765542034,0.6378612921368878,0.6933210321249482,0.6927267061187354,0.6997246328421172,0.6615983292820593,0.7000260256679646,0.7055999384452142,0.6914603234363383,0.6920724729778872,0.6919836741329667,0.67081843135556,0.6171826992333519,0.6242052887676005,0.679460425418885,0.6697153557728256,0.6400684672382153,0.6192531147087778,0.5820987254922806,0.5707524716330115,0.5694595913315843,0.5654841709766341,0.586868676758542,0.5808794088238387,0.5869350290743591,0.5642613234090877,0.5408899196649,0.5323587194665229,0.5252057063199363,0.5296878266170849,0.4915103741431205,0.5001571076227115,0.4513531822444423,0.4919770389490075,0.5260159667990584,0.4986627173931366,0.4956867538683802,0.4661827209382877,0.4671250489826092,0.4738992325983287,0.4896114092366698,0.483968027448874,0.4800144824276336,0.4944795812353143,0.4913215214891378,0.4527104170227674,0.4181700389096336,0.4237502990618845,0.4095734791467329,0.4004907604290124,0.4080549433823885,0.4126002576919441,0.4207658193395076,0.4309703498222446,0.4156263307502562,0.3560867514869861,0.3583451102106899,0.3444745400743902,0.3561046842697184,0.3761064591652243]]},"evals":["attrs.interactionModel"],"jsHooks":[]}</script>
]

---
layout: false
class: inverse, center, middle

# 课后作业

---
class: middle

.bold.font120[

1\. 根据本讲课程讲义的打印稿，在 📑 _qmd_中键入并完成代码的运行

2\. 浏览（阅读）`tidyquant` 包配套的七份 📰 vignettes 

&lt;!-- 3\. 观看视频 🎥 .red.bold[[{{Melt the clock: Tidy time series analysis}}](https://resources.rstudio.com/rstudio-conf-2019/melt-the-clock-tidy-time-series-analysis)] --&gt;

&lt;!-- .red.bold[[{{Melt the clock: Tidy time series analysis}}](https://slides.earo.me/rstudioconf19)] --&gt;

3\. 进一步了解 📦 .red.bold[[{{`slider` 包}}](https://slider.r-lib.org/)]，想想如何通过参数设定实现以下的移动窗口

.pull-left[
&lt;img src="imgs/windows_animate.gif" width="88%" style="display: block; margin: auto;" /&gt;
]

.pull-right.code60[
```r
# 模拟数据
set.seed(123456)
tbl &lt;- tibble(
  Count = runif(16, min=100, max=320) %&gt;% 
    as.integer(), 
  Year = 1997:2012
)

# sliding
tbl %&gt;% 
  mutate(mean = slide_dbl(&lt;...&gt;))
# tiling
tbl %&gt;% 
  mutate(mean = slide_dbl(&lt;...&gt;))
# stretching
tbl %&gt;% 
  ...
```
]

]

---
layout: false
class: center, middle, hide_logo
background-image: url(imgs/xaringan.png)
background-size: 12%
background-position: 50% 40%


&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;hr color='#f00' size='2px' width='80%'&gt;
&lt;br&gt;
.Large.red[_**本网页版讲义的制作由 R 包 [{{`xaringan`}}](https://github.com/yihui/xaringan) 赋能！**_]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
