<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ç¬¬4è®² dplyræ•°æ®å¤„ç† I</title>
    <meta charset="utf-8" />
    <meta name="author" content=" æ›¾æ°¸è‰º" />
    <meta name="date" content="2023-10-12" />
    <script src="../libs/header-attrs/header-attrs.js"></script>
    <link href="../libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="../libs/tile-view/tile-view.js"></script>
    <link href="../libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="../libs/panelset/panelset.css" rel="stylesheet" />
    <script src="../libs/panelset/panelset.js"></script>
    <script src="../libs/freezeframe/freezeframe.min.js"></script>
    <script src="../libs/xaringanExtra-freezeframe/freezeframe-init.js"></script>
    <script id="xaringanExtra-freezeframe-options" type="application/json">{"selector":"img[src$=\"gif\"]","trigger":"click","overlay":false,"responsive":false,"warnings":true}</script>
    <script type="application/json" id="xaringanExtra-editable-docid">{"id":"xad3d946c86d47379e622827c9c2b370","expires":7}</script>
    <script src="../libs/himalaya/himalaya.js"></script>
    <script src="../libs/js-cookie/js.cookie.js"></script>
    <link href="../libs/editable/editable.css" rel="stylesheet" />
    <script src="../libs/editable/editable.js"></script>
    <link href="../libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link href="../libs/animate.css/animate.xaringan.css" rel="stylesheet" />
    <script src="../libs/clipboard/clipboard.min.js"></script>
    <link href="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="../libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-copy\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="../libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="../libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <script src="../libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="../libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="../libs/datatables-binding/datatables.js"></script>
    <script src="../libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="../libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="../libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="../libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="../libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="../libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="../libs/zen-styles-v2.3-rev.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# é‡åŒ–é‡‘èä¸é‡‘èç¼–ç¨‹
]
.subtitle[
## L4 <code>dplyr</code><sup>.font80[1.1.3]</sup> æ•°æ®å¤„ç† | è¯¾å‰é¢„ä¹ 
]
.author[
### <br>æ›¾æ°¸è‰º
]
.institute[
### å¦é—¨å¤§å­¦ç®¡ç†å­¦é™¢
]
.date[
### <br>2023-10-12
]

---

class: middle, hide_logo
background-image: url(imgs/logo-dplyr.png)
background-size: 25%
background-position: 19% 30%



<div>
<style type="text/css">.xaringan-extra-logo {
width: 50px;
height: 50px;
z-index: 0;
background-image: url(imgs/logo-sm.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.5em;right:0.5em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('a')
          logo.classList = 'xaringan-extra-logo'
          logo.href = 'https://qfwr2022.netlify.app'
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

.pull-left.font120.bold.center[
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
_A Grammar of &lt;br&gt;Data Manipulation_
&lt;br&gt;&lt;br&gt;
]

--
 
.pull-right.font150.bold[

&lt;br&gt;

1. æ ·æœ¬å¤„ç†

2. å˜é‡å¤„ç†

3. æ±‡æ€»

4. åˆ†ç»„å¤„ç†

5. ç”¨ `%&gt;%` è¿æ¥å¤šä¸ªæ“ä½œ

]


---


```r
library(tidyverse)
library(nycflights13)

data(package = "nycflights13")
# åŒ…å«airlinesã€airportsã€flightsã€planesã€weatherç­‰5ä¸ªæ•°æ®é›†
```

--


```r
flights  # print() it
```

```
#&gt; # A tibble: 336,776 Ã— 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     1      517            515         2      830            819        11
#&gt; 2  2013     1     1      533            529         4      850            830        20
#&gt; 3  2013     1     1      542            540         2      923            850        33
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```
--

&gt; * `A tibble: 336,776 x 19`
&gt; * `&lt;int&gt;` | `&lt;dbl&gt;` | `&lt;chr&gt;` | `&lt;dttm&gt;` | `&lt;lgl&gt;` | `&lt;fctr&gt;` | `&lt;date&gt;` åˆ†åˆ«è¡¨ç¤ºå˜é‡ä¸º integer | double | character | date-time | logical | factor | date ç±»å‹çš„å‘é‡

--


```r
?flights  # æ‰“å¼€flightsæ•°æ®é›†çš„å¸®åŠ©æ–‡æ¡£ä»¥è¿›ä¸€æ­¥äº†è§£æ•°æ®é›†ï¼Œå¦‚å˜é‡çš„å®šä¹‰
```

---


```r
glimpse(flights)  # æ•°æ®ä¸€ç¥
```

```
#&gt; Rows: 336,776
#&gt; Columns: 19
#&gt; $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,â€¦
#&gt; $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,â€¦
#&gt; $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,â€¦
#&gt; $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, 558, 558, â€¦
#&gt; $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, 600, 600, â€¦
#&gt; $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1, 0, -1, 0â€¦
#&gt; $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849, 853, 924,â€¦
#&gt; $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851, 856, 917,â€¦
#&gt; $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -14, 31, -4,â€¦
#&gt; $ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "AA", "B6",â€¦
#&gt; $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 49, 71, 194â€¦
#&gt; $ tailnum        &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N39463", "N516â€¦
#&gt; $ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA", "JFK", "Lâ€¦
#&gt; $ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD", "MCO", "Oâ€¦
#&gt; $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 158, 345, 3â€¦
#&gt; $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, 1028, 1005â€¦
#&gt; $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6, 6, 6, 6,â€¦
#&gt; $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0, 0, 0, 0,â€¦
#&gt; $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2â€¦
```
--


```r
View(flights)     # åœ¨ RStudio æ•°æ®æµè§ˆå™¨ä¸­æ‰“å¼€æ•°æ®é›†
# tibble::view() è°ƒç”¨ utils::View() å¹¶ä¸å¯è§åœ°è¿”å›åŸæ•°æ®é›†ï¼Œä¾¿äº %&gt;% æ“ä½œï¼Œä½†é€Ÿåº¦å¥½åƒæ…¢å¾ˆå¤š
```

---
layout: false
class: hide_logo

## .font150[ğŸ¤”] æƒ³æƒ³

.font150[å¯¹äºå¦‚ä¸‹ç”±**è¡Œ**ï¼ˆæ ·æœ¬ï¼‰å’Œ**åˆ—**ï¼ˆå˜é‡ï¼‰æ„æˆçš„æ•°æ®é›† / æ•°æ®è¡¨æˆ‘ä»¬ä¼šè¿›è¡Œå“ªäº›æ–¹é¢çš„æ“ä½œå‘¢ï¼Ÿ]

.font80[
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0cb982f32aa3eaee84bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0cb982f32aa3eaee84bd">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],[2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013],[1,1,1,1,1,2,2,2,2,3,3,4,4,5,5,5,8,9,9,12],[6,6,10,12,20,1,16,17,27,4,28,21,22,4,11,29,8,9,29,4],[1434,1436,1841,939,855,1456,649,802,1711,805,1508,1817,622,1038,1147,1614,753,912,853,1004],[-11,-9,-4,19,-5,-6,24,7,56,-5,13,38,-13,-9,-13,29,-7,0,-6,5],[-8,-18,-12,-7,-23,-9,3,-25,30,5,34,71,-22,-7,-21,8,22,-18,-29,28],[94,94,72,76,126,53,109,106,82,160,157,175,223,151,40,270,167,137,295,345],["EV","US","MQ","MQ","UA","EV","WN","WN","DL","DL","B6","B6","UA","DL","US","DL","DL","DL","UA","B6"],["LGA","LGA","LGA","LGA","EWR","EWR","EWR","LGA","JFK","LGA","JFK","LGA","LGA","LGA","LGA","JFK","LGA","LGA","EWR","JFK"],["RDU","CLT","CRW","CLT","ORD","PWM","MDW","MDW","DTW","MSP","PBI","MCO","DEN","SRQ","BOS","SLC","MSP","MIA","LAX","LAS"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>day<\/th>\n      <th>dep_time<\/th>\n      <th>dep_delay<\/th>\n      <th>arr_delay<\/th>\n      <th>air_time<\/th>\n      <th>carrier<\/th>\n      <th>origin<\/th>\n      <th>dest<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
]

---
class: inverse, center, middle

# 1. æ ·æœ¬å¤„ç†

.font150[(manipulate cases)]

---
layout: true

### &gt;&gt; æ ·æœ¬ç­›é€‰ï¼š`filter()`

---

.full-width[.content-box-blue.bold.font120[`filter(.data, ...)`ï¼šæå–æ•°æ®é›† `.data` ä¸­å˜é‡å–å€¼æ»¡è¶³è®¾å®šæ¡ä»¶çš„æ ·æœ¬]]

--


```r
filter(flights, month == 1, day == 1)
*# æ³¨æ„ï¼šæ¡ä»¶è¡¨è¾¾å¼ä¸­çš„æ˜¯ ==ï¼Œè€Œä¸æ˜¯ =
```

```
#&gt; # A tibble: 842 Ã— 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     1      517            515         2      830            819        11
#&gt; 2  2013     1     1      533            529         4      850            830        20
#&gt; 3  2013     1     1      542            540         2      923            850        33
#&gt; # â„¹ 839 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

--


```r
# åœ¨ R åŸºç¡€åŒ…ä¸­çš„å®ç°æ–¹æ³•
flights[flights$month == 1 &amp; flights$day == 1, ]
subset(flights, month == 1 &amp; day == 1)
```


```r
flights[month == 1 &amp; day == 1, ]  # æ³¨æ„ï¼šè¿™æ ·å†™æ˜¯é”™æ»´
```

```
#&gt; Error in month == 1: comparison (==) is possible only for atomic and list types
```

---

.full-width[.content-box-blue.bold.font120.note[dplyr åŒ…ä¸­çš„å‡½æ•°ï¼ˆå¦‚ `filter()` ï¼‰å¹¶ä¸ä¼šç›´æ¥ä¿®æ”¹è¾“å…¥æ•°æ®é›† `.data`]]

--

.full-width[.content-box-blue.bold.font120.warning[ä½ å¿…é¡»è‡ªè¡Œå­˜å‚¨ä¿®æ”¹åçš„æ•°æ®é›† ğŸ’¾]]


```r
dec25 &lt;- filter(flights, month == 12, day == 25)
dec25
```

```
*#&gt; # A tibble: 719 Ã— 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013    12    25      456            500        -4      649            651        -2
#&gt; 2  2013    12    25      524            515         9      805            814        -9
#&gt; 3  2013    12    25      542            540         2      832            850       -18
#&gt; # â„¹ 716 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

```r
flights  # è¾“å…¥æ•°æ®é›†ä»ç„¶ä¿æŒä¸å˜
```

```
*#&gt; # A tibble: 336,776 Ã— 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     1      517            515         2      830            819        11
#&gt; 2  2013     1     1      533            529         4      850            830        20
#&gt; 3  2013     1     1      542            540         2      923            850        33
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

---

.full-width[.content-box-blue.bold.font120.note[`filter()` ä¼šç”¨åˆ°çš„æ¯”è¾ƒè¿ç®—ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦]]

```r
  1. &lt;    &gt;     &lt;=    &gt;=    ==    !=          # ?Comparison
  
  2. &amp;    |     !     xor()                   # ?base::Logic
  
  3. å…¶å®ƒçš„å¦‚ï¼š%in%ã€is.na()ã€between()ã€near() ç­‰
```
--

.full-width[.content-box-blue.bold.font120.note[`filter()` é»˜è®¤ä»¥ `&amp;` çš„æ–¹å¼ç»„åˆå¤šä¸ªæ¡ä»¶å‚æ•°ï¼Œ...]]

--


```r
filter(flights, month &gt;= 11, day == 25)       # ç­‰æ•ˆäº
filter(flights, month &gt;= 11 &amp; day == 25)
```

--

.full-width[.content-box-blue.bold.font120.note[... å…¶å®ƒé€»è¾‘ç»„åˆæ–¹å¼ï¼ˆå¦‚`|`ï¼‰åˆ™éœ€è‡ªè¡Œæ˜ç¡®è®¾å®š]]

---
layout: true

### &gt;&gt; æ ·æœ¬ç­›é€‰ï¼šå…¶å®ƒå‡½æ•°

---

.font120[

* `slice(.data, ..., .by = NULL, .preserve = FALSE)`ï¼šæŒ‰ç…§æ•´æ•°å‘é‡ç»™å‡ºçš„ç´¢å¼•ä½ç½®é€‰æ‹©æ ·æœ¬ï¼Œæ­£ï¼ˆ.red[è´Ÿ]ï¼‰æ•´æ•°è¡¨ç¤ºä¿ç•™ï¼ˆ.red[ç§»é™¤]ï¼‰çš„æ ·æœ¬ï¼Œå¦‚ `slice(mtcars, 5:n())`

* `slice_head(.data, ..., n, prop, by = NULL)` å’Œ `slice_tail()` é€‰æ‹©æ•°æ®é›†å¼€å§‹ / ç»“å°¾çš„æ ·æœ¬ &amp;emsp;&amp;emsp; .red[vs. `utils::head() / tail()`?]

* `slice_sample(.data, ..., n, prop, by = NULL, weight_by = NULL, replace = FALSE)` éšæœºé€‰æ‹©æ ·æœ¬

* `slice_min(.data, order_by, ..., n, prop, by = NULL, with_ties = TRUE, na_rm = FALSE)` å’Œ `slice_max()` é€‰æ‹© `order_by` å‚æ•°æŒ‡å®šçš„å˜é‡æˆ–å…¶å‡½æ•°å–å€¼æœ€å¤§æˆ–æœ€å°çš„æ ·æœ¬

* `distinct(.data, ..., .keep_all = FALSE)`ï¼šç§»é™¤ï¼ˆæŒ‡å®šå˜é‡æˆ–å…¶å‡½æ•°ï¼‰å–å€¼é‡å¤çš„æ ·æœ¬ &amp;emsp;&amp;emsp; .red[â‰ˆ `base::unique()`]

]

--

.footnote.red[æ³¨: åœ¨ dplyr&lt;sup&gt;v1.0.0&lt;/sup&gt; ä¹‹å `top\_n()`ã€`top\_frac()`ã€`sample\_n()` å’Œ `sample\_frac()` ç­‰å‡½æ•°å·²è¢«ç›¸åº”çš„ `slice\_*()` å‡½æ•°æ‰€æ›¿ä»£]

---
layout: true

### &gt;&gt; æ ·æœ¬æ’åºï¼š`arrange()`

---

.full-width[.content-box-blue.bold.font120[`arrange(.data, ...)`ï¼šæ ¹æ®æŒ‡å®šå˜é‡çš„å–å€¼å¯¹æ•°æ®é›† `.data` çš„æ ·æœ¬æ’åº]]

--


```r
arrange(flights, year, month, day, dep_time)
```

```
#&gt; # A tibble: 336,776 Ã— 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     1      517            515         2      830            819        11
#&gt; 2  2013     1     1      533            529         4      850            830        20
#&gt; 3  2013     1     1      542            540         2      923            850        33
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

--


```r
arrange(flights, desc(dep_delay))  # åŠ å…¥ desc() åå‘æ’åºï¼šä»å¤§åˆ°å°
```

```
#&gt; # A tibble: 336,776 Ã— 19
#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     9      641            900      1301     1242           1530      1272
#&gt; 2  2013     6    15     1432           1935      1137     1607           2120      1127
#&gt; 3  2013     1    10     1121           1635      1126     1239           1810      1109
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

---

.full-width[.content-box-blue.bold.font120.note[ä¸åƒ dplyr åŒ…ä¸­çš„å…¶å®ƒå‡½æ•°ï¼Œ`arrange(.data, ..., .by_group = FALSE)` ä¼šå¿½ç•¥æ•°æ®é›†çš„åˆ†ç»„ä¿¡æ¯ï¼Œé™¤éæ˜ç¡®åŠ å…¥åˆ†ç»„å˜é‡æˆ–è®¾å®š `.by_group = TRUE`]]

--

.full-width[.content-box-blue.bold.font120.note[ç¼ºå¤±å€¼æ€»æ˜¯æ’åœ¨æœ€å &lt;sup&gt;.red[*]&lt;/sup&gt; ]]

--
.pull-left[

```r
df &lt;- tibble(x = c(1, 3, 2, NA))
arrange(df, x)
```

```
#&gt; # A tibble: 4 Ã— 1
#&gt;       x
#&gt;   &lt;dbl&gt;
#&gt; 1     1
#&gt; 2     2
*#&gt; 3     3
#&gt; 4    NA
```
]

--
.pull-right[

```r
df &lt;- tibble(x = c(1, 3, 2, NA))
arrange(df, desc(x))
```

```
#&gt; # A tibble: 4 Ã— 1
#&gt;       x
#&gt;   &lt;dbl&gt;
#&gt; 1     3
#&gt; 2     2
*#&gt; 3     1
#&gt; 4    NA
```
]

--

.footnote.red[*ï¼š`base::sort()` å’Œ `base::order()` é€šè¿‡å‚æ•° `na.last` æ¥æ§åˆ¶æŠŠç¼ºå¤±å€¼æ”¾åœ¨å“ªé‡Œæˆ–åˆ é™¤ï¼Œå¹¶é€šè¿‡å‚æ•° `decreasing` æ¥æ§åˆ¶æ’åºæ–¹å‘ã€‚]

---
layout: false
class: inverse, center, middle

# 2. å˜é‡å¤„ç†

.font150[(manipulate variables)]

---
layout: true

### &gt;&gt; å˜é‡é€‰å–ï¼š`select(.data, ...)`

---


```r
select(flights, month, day, dep_time, sched_dep_time, dep_delay)  # æšä¸¾å¼ï¼šå˜é‡åï¼Œæ— éœ€""
```

```
#&gt; # A tibble: 336,776 Ã— 5
#&gt;   month   day dep_time sched_dep_time dep_delay
#&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1     1     1      517            515         2
#&gt; 2     1     1      533            529         4
#&gt; 3     1     1      542            540         2
#&gt; # â„¹ 336,773 more rows
```

--


```r
select(flights, 2, 3, 4, 5, 6)  # æšä¸¾å¼ï¼šè¡¨ç¤ºå˜é‡ä½ç½®çš„æ•°å­—ï¼Œç»“æœåŒä¸Šï¼Œä½†ä¸æ¨è
```

--

```r
select(flights, month:dep_delay)  # ç”¨ : é€‰æ‹©è¿åœ¨ä¸€èµ·çš„å˜é‡
select(flights, 2:6)
```

--

```r
select(flights, !(month:dep_delay))  # å˜é‡å‰çš„ ! æˆ– - è¡¨ç¤ºå‰”é™¤
```

```
#&gt; # A tibble: 336,776 Ã— 14
#&gt;    year arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
#&gt;   &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
#&gt; 1  2013      830            819        11 UA        1545 N14228  EWR    IAH        227
#&gt; 2  2013      850            830        20 UA        1714 N24211  LGA    IAH        227
#&gt; 3  2013      923            850        33 AA        1141 N619AA  JFK    MIA        160
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

.full-width[.content-box-blue.bold.font110.note[`select()` çš„è¾…åŠ©å‡½æ•°ï¼Œå·²æå‡ºåˆ° `tidyselect` åŒ…ä¸­ï¼Œ`?select_helpers`]]

  1. `starts_with("abc")`ï¼šé€‰å–å˜é‡åä»¥ `abc` å¼€å¤´çš„å˜é‡
  2. `ends_with("xyz")`ï¼šé€‰å–å˜é‡åä»¥ `xyz` ç»“æŸçš„å˜é‡
  3. `contains("ijk")`ï¼šé€‰å–å˜é‡ååŒ…å« `ijk` çš„å˜é‡
  4. `matches("(.)\\1")`ï¼šé€‰å–å˜é‡åä¸­å‡ºç°é‡å¤å­—ç¬¦çš„å˜é‡
  5. `num_range("x", 1:3)`ï¼šé€‰å–å˜é‡ `x1`ã€`x2` å’Œ `x3`
  6. `any_of(x) | all_of(x)`ï¼šé€‰æ‹©æ•´æ•°å‘é‡ `x` æŒ‡å®šä½ç½®æˆ–*å­—ç¬¦å‘é‡* `x` ç›´æ¥æŒ‡å®šçš„å˜é‡
  7. `last_col(offset = 0L)`ï¼šé€‰æ‹©ä»æœ€åç®—èµ·çš„ç¬¬ `offset+1` ä¸ªçš„å˜é‡
  8. `everything()`ï¼šå…¨éƒ¨å˜é‡ï¼Œé€šå¸¸æ”¾åœ¨æœ€å
  9. `where(fn)`ï¼šé€‰æ‹©æ»¡è¶³æ–­è¨€å‡½æ•° `fn` æ¡ä»¶çš„å˜é‡ï¼Œå¦‚ `select(data, where(is.integer))`

--

.full-width[.content-box-blue.bold.font110.note[`select()`ï¼šå¯æ··åˆä½¿ç”¨å„ç§æ–¹æ³•]]


```r
select(flights, year:day, ends_with("_delay") | starts_with("dep_"), tailnum)
```

```
#&gt; # A tibble: 336,776 Ã— 7
#&gt;    year month   day dep_delay arr_delay dep_time tailnum
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;  
#&gt; 1  2013     1     1         2        11      517 N14228 
#&gt; 2  2013     1     1         4        20      533 N24211 
#&gt; 3  2013     1     1         2        33      542 N619AA 
#&gt; # â„¹ 336,773 more rows
```

---
layout: false

### &gt;&gt; å˜é‡é‡å‘½åï¼š`select()`ã€`rename()` å’Œ `rename_with()`


```r
select(flights, nian = year, yue = month, ri = day)  # é€‰å–å˜é‡çš„åŒæ—¶é‡å‘½åå˜é‡
```

```
#&gt; # A tibble: 336,776 Ã— 3
#&gt;    nian   yue    ri
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1  2013     1     1
#&gt; 2  2013     1     1
#&gt; 3  2013     1     1
#&gt; # â„¹ 336,773 more rows
```

--


```r
# select() åªä¿ç•™æŒ‡å®šçš„å˜é‡ï¼Œè€Œ rename(.data, ...) åˆ™ä¼šä¿ç•™å…¨éƒ¨å˜é‡
rename(flights, nian = year, yue = month, ri = day) %&gt;% dim()
```

```
#&gt; [1] 336776     19
```

--


```r
# rename_with(.data, .fn, .cols = everything(), ...)
rename_with(flights, toupper, 1:3)
```

```
#&gt; # A tibble: 336,776 Ã— 19
#&gt;    YEAR MONTH   DAY dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     1      517            515         2      830            819        11
#&gt; 2  2013     1     1      533            529         4      850            830        20
#&gt; 3  2013     1     1      542            540         2      923            850        33
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

---
layout: false

### &gt;&gt; å˜é‡æ¬¡åºè°ƒæ•´ï¼š`select()` å’Œ `relocate()`


```r
select(flights, dest, year:day, ends_with("_delay"), everything())
```

```
#&gt; # A tibble: 336,776 Ã— 19
#&gt;   dest   year month   day dep_delay arr_delay dep_time sched_dep_time arr_time
#&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;    &lt;int&gt;
#&gt; 1 IAH    2013     1     1         2        11      517            515      830
#&gt; 2 IAH    2013     1     1         4        20      533            529      850
#&gt; 3 MIA    2013     1     1         2        33      542            540      923
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: sched_arr_time &lt;int&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

--


```r
relocate(flights, dest, year:day, ends_with("_delay"))  # ç»“æœåŒä¸Š
```

--


```r
# relocate(.data, ..., .before = NULL, .after = NULL)
relocate(flights, ends_with("_delay"), .after = day)
```

```
#&gt; # A tibble: 336,776 Ã— 19
#&gt;    year month   day dep_delay arr_delay dep_time sched_dep_time arr_time sched_arr_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     1         2        11      517            515      830            819
#&gt; 2  2013     1     1         4        20      533            529      850            830
#&gt; 3  2013     1     1         2        33      542            540      923            850
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,
#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
#&gt; #   time_hour &lt;dttm&gt;
```

---
layout: true

### &gt;&gt; ç”Ÿæˆæ–°å˜é‡ï¼š`mutate()`

---

.full-width[.content-box-blue.bold.font120[`mutate(.data, ...)`ï¼šç”Ÿæˆæ–°å˜é‡ .red[&lt;sup&gt; *&lt;/sup&gt;]]]
--


```r
flights_sml &lt;- select(flights, year:day, ends_with("_delay"), air_time)
```
--


```r
mutate(flights_sml,
  gain = arr_delay - dep_delay,
  hours = air_time / 60,
  gain_per_hour = gain / hours    # å¯ç›´æ¥å¼•ç”¨æ–°ç”Ÿæˆçš„å˜é‡
)
```

```
#&gt; # A tibble: 336,776 Ã— 9
#&gt;    year month   day dep_delay arr_delay air_time  gain hours gain_per_hour
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
#&gt; 1  2013     1     1         2        11      227     9  3.78          2.38
#&gt; 2  2013     1     1         4        20      227    16  3.78          4.23
#&gt; 3  2013     1     1         2        33      160    31  2.67         11.6 
#&gt; # â„¹ 336,773 more rows
```

--
.footnote.red[*ï¼šå®Œæ•´å‚æ•°ç‰ˆä¸º `mutate(.data, ..., .by = NULL, .keep = c("all", "used", "unused", "none"), .before = NULL, .after = NULL)`ï¼ˆå…¶ä¸­ï¼š`.keep`ã€`.before`å’Œ`.after`ä¸ºv1.0.0æ–°å¢å‚æ•°ï¼Œv1.1.0åˆæ–°å¢å®éªŒæ€§å‚æ•°`.by`ï¼‰ï¼›&lt;br&gt;2. å‡å¦‚ä½ åªæƒ³ä¿ç•™æ–°ç”Ÿæˆçš„å˜é‡ï¼Œé‚£å°±~~ä½¿ç”¨ `transmute()` æˆ–~~è®¾å®š `mutate()` å‚æ•° `.keep = "none"`ã€‚]

---

.full-width[.content-box-blue.bold.font120[`mutate()`ï¼šæ”¯æŒå‘é‡åŒ–å‡½æ•° &lt;sup&gt;.red[*]&lt;/sup&gt;]]

.code75[

```r
*MATH
  +, - , *, /, ^, %/%, %%    # arithmetic ops
  log(), log2(), log10()     # logs
  &lt;, &lt;=, &gt;, &gt;=, !=, ==       # logical comparisons
*CUMULATIVE AGGREGATES        # vignette("window-functions")
  dplyr::cumall()|cumany()   # cumulative all() | any()
  cummax()|cummin()          # cumulative max() | min()
  dplyr::cummean()           # cumulative mean()
  cumprod()|cumsum()         # cumulative prod() | sum()
*OFFSETS
  dplyr::lag()|lead()        # offset elements by 1 | -1
*RANKINGS                     # ?ranking
  dplyr::min_rank()          # rank with ties = min
  dplyr::ntile()             # bins into n bins
  dplyr::row_number()        # rank with ties = "first"
*MISC
  pmax()|pmin()              # element-wise max() | min()
  dplyr::recode()            # vectorized switch()
  dplyr::if_else()           # vectorized if() + else()
  dplyr::case_when()         # multi-case if_else()
```
]

.footnote.red[*ï¼šå½“ç„¶ä¹Ÿæ”¯æŒè¿”å›â€œæ ‡é‡â€çš„æ±‡æ€»å‡½æ•°ï¼Œå¦‚ `mean()`ï¼Œä¼šå°†æ ‡é‡ç›´æ¥æ‰©å±•è‡³éœ€è¦çš„é•¿åº¦ã€‚]

---
layout: false
class: inverse, center, middle

# 3. æ±‡æ€»

.font150[(summarize)]

---
layout: true

### &gt;&gt; æ±‡æ€»ï¼š`summarize()`

---

.font120[
- `summarize(.data, ..., .by = NULL, .groups = NULL)` å‡½æ•°ç”Ÿæˆæ–°çš„æ•°æ®æ¡†ï¼Œæ¯ä¸ªæ±‡æ€»å‡½æ•°å ä¸€åˆ—ï¼Œæ¯ä¸ªåˆ†ç»„å ç”¨ä¸€è¡Œï¼›

- å¦‚æœ `.data` æ˜¯[åˆ†ç»„æ•°æ®æ¡† ğŸ‘‡](#56)ï¼Œåˆ™æ¯ä¸ªåˆ†ç»„å˜é‡è¿˜ä¼šå ä¸€åˆ—ï¼›æ­¤æ—¶ï¼Œè¿˜å¯ç”¨ dplyr&lt;sup&gt;v1.0.0&lt;/sup&gt; æ–°å¢çš„å®éªŒæ€§å‚æ•° `.groups = c("drop_last", "drop", "keep", "rowwise")` æ¥æ§åˆ¶æ–°ç”Ÿæˆç»“æœæ•°æ®æ¡†çš„åˆ†ç»„ç»“æ„ï¼›

- å¦‚æœåªæƒ³å¯¹ `.data` è¿›è¡Œä¸€æ¬¡æ€§çš„åˆ†ç»„æ±‡æ€»ï¼ˆä¸ä¿ç•™åˆ†ç»„ç»“æ„ï¼‰ï¼Œåˆ™å¯ä½¿ç”¨ dplyr&lt;sup&gt;v1.1.0&lt;/sup&gt; æ–°å¢çš„å®éªŒæ€§å‚æ•° `.by`ã€‚
]


```r
summarize(
  flights, 
  mean_delay = mean(dep_delay, na.rm = TRUE), 
  sd_delay   = sd(dep_delay, na.rm = TRUE)
)
```

```
#&gt; # A tibble: 1 Ã— 2
#&gt;   mean_delay sd_delay
#&gt;        &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1       12.6     40.2
```

---

.font120.note[`summarize()` æ”¯æŒè¿”å›â€œæ ‡é‡â€çš„æ±‡æ€»å‡½æ•°&lt;sup&gt;.red[*]&lt;/sup&gt;ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š]


```r
*COUNTS
  dplyr::n()                # number of values/rows
  dplyr::n_distinct()       # number of uniques
  sum(!is.na())             # number of non-NAâ€™s
*LOCATION
  mean() | median()         # mean | median
*POSITION/ORDER
  dplyr::first()            # first value
  dplyr::last()             # last value
  dplyr::nth()              # value in n-th location of vector
*RANK
  quantile()                # nth quantile
  min() | max()             # minimum value | maximum value
*SPREAD
  IQR()                     # Inter-Quartile Range
  mad()                     # median absolute deviation
  sd()                      # standard deviation
  var()                     # variance
```

.footnote.red[*ï¼šdplyr&lt;sup&gt;v1.0.0&lt;/sup&gt; æ‰©å±•äº† `summarize()` çš„çµæ´»æ€§ï¼ˆå…è®¸å…¶è¿”å›åŒ…å«å¤šä¸ªå…ƒç´ çš„å‘é‡ç”šè‡³æ˜¯å¤šåˆ—çš„æ•°æ®æ¡†ï¼‰ï¼Œä½† dplyr&lt;sup&gt;v1.1.0&lt;/sup&gt; åœ¨æ­¤åº”ç”¨æƒ…æ™¯ä¸‹ä¼šæç¤ºæ”¹ç”¨å®éªŒæ€§çš„ `reframe()`ã€‚]

---
layout: false
class: inverse, center, middle

# 4. åˆ†ç»„å¤„ç†

.font150[(grouping)]

---
layout: true

### &gt;&gt; åˆ†ç»„å¤„ç†ï¼š`group_by()`

---

- `group_by(.data, ..., .add = FALSE, .drop = group_by_drop_default(.data))` å°†æ•°æ®æ¡†åŠå…¶æ‰©å±•è½¬å˜ä¸ºåˆ†ç»„æ•°æ®æ¡†ï¼ˆ`grouped_df`ï¼‰

--

.pull-left[


```r
by_day &lt;- group_by(flights, 
                   year, month, day)
class(by_day)
```

```
#&gt; [1] "grouped_df" "tbl_df"     "tbl"       
#&gt; [4] "data.frame"
```


```r
by_day
```

```
#&gt; # A tibble: 336,776 Ã— 19
*#&gt; # Groups:   year, month, day [365]
#&gt;    year month   day dep_time sched_dep_time
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
#&gt; 1  2013     1     1      517            515
#&gt; 2  2013     1     1      533            529
#&gt; 3  2013     1     1      542            540
#&gt; # â„¹ 336,773 more rows
#&gt; # â„¹ 14 more variables: dep_delay &lt;dbl&gt;,
#&gt; #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#&gt; #   flight &lt;int&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, â€¦
```

]

--

.pull-right[

.font100.bold.note[è·å–åˆ†ç»„å…ƒæ•°æ®çš„ç›¸å…³å‡½æ•°]


```r
by_day %&gt;% group_vars()
```

```
#&gt; [1] "year"  "month" "day"
```

```r
by_day %&gt;% group_data()
```

```
#&gt; # A tibble: 365 Ã— 4
#&gt;    year month   day       .rows
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;list&lt;int&gt;&gt;
#&gt; 1  2013     1     1       [842]
#&gt; 2  2013     1     2       [943]
#&gt; 3  2013     1     3       [914]
#&gt; # â„¹ 362 more rows
```

```r
# group_keys() / 
# group_rows() / group_indices()
# group_size() / n_groups()
```
]

---

- `group_by()` å¯¹æ•°æ®æ¡†çš„åˆ†ç»„è®¾å®šä¼šå½±å“åç»­ dplyr åŒ…å‡½æ•°çš„æ“ä½œæ–¹å¼ï¼Œå¦‚ `mutate()`ã€`summarize()`ã€`filter()`ã€`slice()`ç­‰ï¼›å¦‚æœä½ ä¸éœ€è¦åŸºäºåˆ†ç»„è¿›è¡Œåç»­æ“ä½œï¼Œéœ€å…ˆç”¨ `ungroup(x, ...)` å‡½æ•°æ¥å–æ¶ˆå¯¹æ•°æ®é›† `x`ï¼ˆåŸºäºæŒ‡å®šå˜é‡ `...`ï¼‰çš„åˆ†ç»„è®¾å®š

--

.pull-left[


```r
*# åˆ†ç»„æ±‡æ€»
# è¿”å›ç»“æœé»˜è®¤æƒ…å†µä¸‹ä¼šå»é™¤æœ€ä½ä¸€çº§åˆ†ç»„ï¼Œ
# é™¤éè®¾å®šå‚æ•° .groups = 'keep'
summarize(
  by_day, 
  mean_delay = mean(
    dep_delay, na.rm = TRUE
  )
)
```

```
#&gt; # A tibble: 365 Ã— 4
*#&gt; # Groups:   year, month [12]
#&gt;    year month   day mean_delay
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;
#&gt; 1  2013     1     1       11.5
#&gt; 2  2013     1     2       13.9
#&gt; 3  2013     1     3       11.0
#&gt; # â„¹ 362 more rows
```
]

--

.pull-right[


```r
# å‡å¦‚ä½ è§‰å¾— group_by() + summarize()ä¸å¤Ÿå¼º
# å¤§ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨å®éªŒæ€§çš„ purrr-style å‡½æ•°ï¼Œ
# å¦‚ group_map()/*_modify()/*_walk() ç­‰
group_modify(
  by_day,
  ~ broom::tidy( # what's this?!
      lm(arr_delay ~ dep_delay, data=.x)
    )
)
```

```
#&gt; # A tibble: 730 Ã— 8
*#&gt; # Groups:   year, month, day [365]
#&gt;    year month   day term   estimate std.error
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
#&gt; 1  2013     1     1 (Inteâ€¦    0.910    0.579 
#&gt; 2  2013     1     1 dep_dâ€¦    1.03     0.0124
#&gt; 3  2013     1     2 (Inteâ€¦   -1.32     0.581 
#&gt; # â„¹ 727 more rows
#&gt; # â„¹ 2 more variables: statistic &lt;dbl&gt;,
#&gt; #   p.value &lt;dbl&gt;
```
]


---
layout: false
class: inverse, center, middle
background-image: url(imgs/logo-magrittr.png), url(imgs/bg.png)
background-size: 10%, 100%
background-position: 15% 40%, 0% 100%

# 5. ç”¨ `%&gt;%` è¿æ¥å¤šä¸ªæ“ä½œ

.font150[(chaining multiple operations with the pipe `%&gt;%`)]

---
layout: true

### &gt;&gt; ç®¡é“è¿ç®—ç¬¦ï¼š`%&gt;%`

---
.full-width[.content-box-blue.bold.font120[ä¸ç”¨&amp;nbsp;`%&gt;%`&amp;nbsp;çš„ä»£ç ]]

.pull-left[

```r
by_dest &lt;- group_by(flights, dest)

delay &lt;- summarize(
  by_dest,
  count = n(),
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE)
)

delay &lt;- filter(delay, 
                count &gt; 20, 
                dest != "HNL")

ggplot(delay, 
       aes(x = dist, y = delay)) +
  geom_point(aes(size = count), 
             alpha = 1/3) +
  geom_smooth(se = FALSE)
```
]

&lt;br&gt;&lt;br&gt;

.pull-right[

&lt;img src="L04_Transformation_Prep_files/figure-html/unnamed-chunk-41-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
.full-width[.content-box-blue.bold.font120[ä½¿ç”¨&amp;nbsp;`%&gt;%`&amp;nbsp;çš„ä»£ç ï¼ˆ&amp;nbsp;`%&gt;%`&amp;nbsp;æ¥è‡ª&amp;nbsp;`magrittr`&amp;nbsp;åŒ…ï¼Œå¿«æ·é”®ä¸º&amp;nbsp;`Ctrl+Shift+M`&amp;nbsp;ï¼‰]]

.pull-left[

```r
# ç”¨ %&gt;% æ”¹å†™å‰ä¸€é¡µçš„ä»£ç 
flights %&gt;% 
  group_by(dest) %&gt;% 
  summarize(
    count = n(),
    dist = mean(distance, na.rm = TRUE),
    delay = mean(arr_delay, na.rm = TRUE)
  ) %&gt;% 
  filter(count &gt; 20, dest != "HNL") %&gt;% 
  ggplot(aes(x = dist, y = delay)) +
    geom_point(aes(size = count), 
               alpha = 1/3) +
    geom_smooth(se = FALSE)
```
]

--

.pull-right.font110[

* è®©å‡½æ•°å…¼å®¹ç®¡é“æ“ä½œç¬¦æœ‰åŠ©äºå®ç° `tidyverse` çš„[{{æ ¸å¿ƒåŸåˆ™}}](https://design.tidyverse.org/unifying.html)

* ä½¿ç”¨ `%&gt;%` ç¼–å†™çš„ä»£ç å…³æ³¨åŠ¨è¯ï¼ˆå¦‚æ•°æ®å˜æ¢æ“ä½œï¼‰è€Œéåè¯ï¼ˆæ“ä½œå¯¹è±¡ï¼‰ï¼Œè¿™ä½¿å¾—ä»£ç æ›´å®¹æ˜“å†™ï¼Œæ›´å®¹æ˜“è¯»ï¼Œä¹Ÿæ›´å®¹æ˜“ä¿®æ”¹

* `dplyr` åŒ…çš„å‡½æ•°å…·å¤‡è¿™æ ·çš„ç‰¹æ€§ï¼š`f(.data01, ...)  -&gt; .data02`ï¼Œâ€œæ•°æ®è¿›ï¼Œæ•°æ®å‡ºâ€ï¼Œæ›´é€‚ç”¨äºç®¡é“æ“ä½œ

* `dplyr` åŒ…ä¼šåœ¨åå°è‡ªåŠ¨å°† `x %&gt;% f(y)` è½¬å˜ä¸º `f(x, y)`ï¼Œå°† `x %&gt;% f(y, .)` è½¬å˜ä¸º `f(y, x)`ï¼Œå°† `x %&gt;% f(y, z = .)`  è½¬å˜ä¸º `f(y, z = x)` â€¦â€¦

]

---
.full-width[.content-box-blue.bold.font120[ä½¿ç”¨&amp;nbsp;`%&gt;%`&amp;nbsp;çš„ä¾‹å­ï¼Œonce moreï¼Œâœˆï¸]]


```r
flights %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarize(mean_delay = mean(dep_delay, na.rm = TRUE)) %&gt;% 
  mutate(date = lubridate::make_date(year, month, day)) %&gt;% 
  ggplot() + geom_line(aes(x = date, y = mean_delay))
```

&lt;img src="L04_Transformation_Prep_files/figure-html/unnamed-chunk-43-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---
.full-width[.content-box-blue.bold.font120[yet again .red[but with R's native forward pipe operator `|&gt;`]]]


```r
not_cancelled &lt;- flights |&gt;  
  filter(!is.na(dep_delay), !is.na(arr_delay))

not_cancelled |&gt; 
  group_by(year, month, day) |&gt; 
  summarize(
*   first = dep_time |&gt; min(),
*   last  = dep_time %&gt;% max,
    avg_delay1 = mean(arr_delay),
    avg_delay2 = mean(arr_delay[arr_delay &gt; 0]) # average pos delay
  )
```

```
#&gt; # A tibble: 365 Ã— 7
#&gt; # Groups:   year, month [12]
#&gt;    year month   day first  last avg_delay1 avg_delay2
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1  2013     1     1   517  2356      12.7        32.5
#&gt; 2  2013     1     2    42  2354      12.7        32.0
#&gt; 3  2013     1     3    32  2349       5.73       27.7
#&gt; # â„¹ 362 more rows
```

---
layout: false
class: center, middle, hide_logo
background-image: url(imgs/xaringan.png)
background-size: 12%
background-position: 50% 40%

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;hr color='#f00' size='2px' width='80%'&gt;
&lt;br&gt;
.Large.red[_**æœ¬ç½‘é¡µç‰ˆè®²ä¹‰çš„åˆ¶ä½œç”± R åŒ… [{{`xaringan`}}](https://github.com/yihui/xaringan) èµ‹èƒ½ï¼**_]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
